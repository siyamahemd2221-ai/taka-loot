<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taka Loot Lite - Earn Money</title>
    <!-- Firebase App (v8) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <!-- Font Awesome and Google Fonts for New Login Page -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Jost:wght@500&display=swap" rel="stylesheet">


<style>
    :root {
        --theme-color: #f0b90b; /* ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶•‡ßá‡¶ï‡ßá ‡¶è‡¶á ‡¶∞‡¶ô ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá */
        --theme-color-light: #f8d44c;
        --theme-gradient: linear-gradient(90deg, #f0b90b, #f8d44c);
    }
    
    
    
    @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');
    
    /* General Body Styles */
    body { 
        font-family: 'Roboto', sans-serif; 
        margin: 0; 
        padding: 0; 
        display: flex; 
        justify-content: center; 
        align-items: center; 
        min-height: 100vh; 
        background-color: #0d1117;
        color: #333; 
        overflow-x: hidden;
    }

    .hidden { display: none !important; }

    /* --- New Auth Section Styles from login.html --- */
    #auth-section {
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        font-family: 'Jost', sans-serif;
        background: linear-gradient(to right, #0d1117, #333); /* New attractive gradient */
        width: 100%;
        height: 100vh;
        box-sizing: border-box;
    }
    .main {
        width: 380px;
        height: 550px; /* Adjusted height for fatter inputs */
        background: rgba(255, 255, 255, 0.1);
        overflow: hidden;
        border-radius: 15px;
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
        border-top: 1px solid rgba(255, 255, 255, 0.5);
        border-left: 1px solid rgba(255, 255, 255, 0.5);
        backdrop-filter: blur(5px);
    }
    #chk {
        display: none;
    }
    .signup {
        position: relative;
        width: 100%;
        height: 100%;
    }
    #auth-section label {
        color: #fff;
        font-size: 2.3em;
        justify-content: center;
        display: flex;
        margin: 40px;
        font-weight: bold;
        cursor: pointer;
        transition: .5s ease-in-out;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
    }
    .input-container {
        position: relative;
        width: 80%;
        margin: 25px auto; /* Increased margin */
    }
    .input-container i {
        position: absolute;
        left: 20px;
        top: 50%;
        transform: translateY(-50%);
        color: #333;
    }
    #auth-section input {
        width: 100%;
        height: 50px; /* Made the input box "fatter" */
        background: #e0e0e0;
        box-sizing: border-box;
        padding: 10px 20px 10px 50px;
        border: 2px solid transparent; /* Added border for focus effect */
        outline: none;
        border-radius: 50px; /* Fully rounded input fields */
        font-size: 1em;
        transition: all 0.3s ease;
    }
    #auth-section input:focus {
        background-color: #fff;
        border-color: #66a6ff; /* Border color on focus */
        box-shadow: 0 0 10px rgba(102, 166, 255, 0.5);
    }
    #auth-section button {
        width: 60%;
        height: 50px; /* Increased button height */
        margin: 20px auto;
        justify-content: center;
        display: block;
        color: #fff;
        background: #57b894; /* New attractive button color */
        font-size: 1.1em;
        font-weight: bold;
        outline: none;
        border: none;
        border-radius: 50px; /* Made the button fully rounded */
        transition: .2s ease-in;
        cursor: pointer;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    #auth-section button:hover {
        background: #4a9d7f;
    }
    .login {
        height: 520px;
        background: #fff;
        border-radius: 60% / 10%;
        transform: translateY(-150px);
        transition: .8s ease-in-out;
    }
    .login label {
        color: #57b894 !important; /* Matched with the new button color */
        transform: scale(.6);
    }
    #chk:checked ~ .login {
        transform: translateY(-550px); /* Adjusted slide position */
    }
    #chk:checked ~ .login label {
        transform: scale(1);
    }
    #chk:checked ~ .signup label {
        transform: scale(.6);
    }
    .auth-error-message {
        text-align:center; 
        color: #D0021B; 
        font-weight: bold; 
        margin: -25px auto 10px;
        font-size: 0.8em;
        min-height: 18px;
        width: 80%;
    }
    
    /* Main Container for App */
    .container { 
        max-width: 420px; 
        width: 100%; 
        background: #0d1117; 
        border: 1px solid #30363d; 
        border-radius: 12px; 
        box-shadow: 0 8px 24px rgba(0,0,0,0.4); 
        padding: 0; 
        overflow: hidden; 
        display: flex;
        flex-direction: column;
        height: 100vh;
        color: #c9d1d9; 
    }
    
    #user-panel {
        display: flex;
        flex-direction: column;
        height: 100%;
    }
    
    #pages-container {
        flex-grow: 1;
        overflow-y: auto;
        background-color: #0d1117; 
    }

    .main-content { padding: 20px; box-sizing: border-box; }
    h2, h3 { text-align: center; color: var(--theme-color); }
    .btn { width: 100%; padding: 12px; border: none; border-radius: 8px; background: var(--theme-gradient); color: #161b22; font-size: 16px; font-weight: 600; cursor: pointer; transition: filter 0.3s; }
    .btn:hover { filter: brightness(1.1); }
    .btn:disabled { background: #555; color: #999; cursor: not-allowed; filter: none; }
    .header-card { display: flex; align-items: center; justify-content: space-between; padding: 15px 20px; background-color: #21262d; }
    .user-info img { width: 40px; height: 40px; border-radius: 50%; margin-right: 15px; object-fit: cover; }
    .user-details h3 { margin: 0; font-size: 18px; text-align: left; color: #FFFFFF; }
    .user-details p { margin: 0; font-size: 12px; color: #8b949e; }
    .balance-card { background: var(--theme-gradient); padding: 5px 15px; border-radius: 20px; color: #161b22; font-weight: 700; }
    
    #coin-wallet-section { display: flex; justify-content: space-between; align-items: center; background-color: #21262d; padding: 15px 20px; margin: 20px 20px 20px 20px; border-radius: 12px; }
    .coin-balance-display p { margin: 0; font-size: 14px; color: #8b949e; }
    .coin-balance-display h4 { margin: 5px 0 0; font-size: 20px; color: #fff; display: flex; align-items: center; }
    .coin-balance-display img { width: 24px; height: 24px; margin-right: 8px; }
    #exchange-coins-btn { background: var(--theme-gradient); color: #161b22; border: none; padding: 10px 20px; border-radius: 8px; font-weight: 600; cursor: pointer; width: auto; }
    
    .task-grid { 
        display: grid; 
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); 
        gap: 15px; 
        padding: 20px; 
        background-color: #0d1117; 
        flex-grow: 1;
        overflow-y: auto;
    } 
    .task-item { background-color: #21262d; border-radius: 12px; padding: 20px 15px; text-align: center; cursor: pointer; transition: transform 0.2s; border: 1px solid #30363d; } 
    .task-item:hover { transform: translateY(-5px); }
    .task-item .icon { font-size: 40px; margin-bottom: 10px; color: var(--theme-color); } 
    .task-item p { margin: 0; font-weight: 600; color: #c9d1d9; } 

    #home-page {
        display: flex;
        flex-direction: column;
        height: 100%;
        overflow: hidden; 
    }
    .header-card, #coin-wallet-section {
        flex-shrink: 0;
    }

    .bottom-nav {
        display: flex;
        justify-content: space-around;
        padding: 5px 0 10px 0;
        background-color: #21262d;
        border-top: 1px solid #30363d;
        position: relative;
        z-index: 10;
        flex-shrink: 0;
        height: 65px;
        box-sizing: border-box;
    }
    .nav-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: #8b949e;
        cursor: pointer;
        flex: 1;
        text-align: center;
        gap: 2px;
        transition: color 0.3s ease;
    }
    .nav-item img {
        width: 28px;
        height: 28px;
        margin-bottom: 2px;
        filter: grayscale(100%);
        opacity: 0.7;
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    .nav-item span {
        font-size: 12px;
        font-weight: 500;
        line-height: 1;
        transition: color 0.3s ease;
    }
    .nav-item.active {
        color: var(--theme-color);
    }
    .nav-item.active img {
        transform: translateY(-5px);
        filter: invert(84%) sepia(49%) saturate(4462%) hue-rotate(349deg) brightness(101%) contrast(102%) drop-shadow(0px 3px 6px rgba(240, 185, 11, 0.4));
        opacity: 1;
    }
    
    .page-header { position: relative; display: flex; align-items: center; justify-content: center; padding: 0 10px 15px 10px; min-height: 48px; }
    .page-header h3 { flex-grow: 1; text-align: center; margin: 0; color: var(--theme-color); }
    .page-header .back-btn {
        background: none;
        border: none;
        color: var(--theme-color);
        cursor: pointer;
        padding: 0;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        position: absolute;
        left: 0;
        top: 50%;
        transform: translateY(-60%);
    }
    
    #vip-task-container { display: flex; flex-direction: column; gap: 15px; }
    .vip-task-item { display: flex; justify-content: space-between; align-items: center; background-color: #21262d; padding: 15px; border-radius: 8px; border-left: 5px solid var(--theme-color); }
    .vip-task-item p { margin: 0; font-size: 16px; color: #c9d1d9; font-weight: 500; }
    .btn-claim-vip-task { background: var(--theme-gradient); color: #161b22; padding: 8px 18px; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; min-width: 80px; text-align: center;}
    .btn-claim-vip-task:disabled { background: #43a047; color: white; cursor: not-allowed; }
    .no-plan-container { text-align: center; padding: 40px 20px; background-color: #161b22; border-radius: 12px; }
    .no-plan-container h3 { color: #f8d44c; }
    .no-plan-container p { color: #8b949e; margin-bottom: 25px; }
    
    /* VIP Plan Header */
    .active-plan-header { padding: 15px; background-color: #21262d; color: #c9d1d9; border-radius: 12px; margin-bottom: 20px; display: flex; justify-content: center; align-items: center; box-shadow: none; border: 1px solid var(--theme-color); }
    .active-plan-header .plan-name-display { font-size: 20px; font-weight: bold; color: var(--theme-color); }
    .active-plan-header .plan-status-badge { background-color: #007bff; color: white; padding: 3px 10px; border-radius: 15px; font-size: 11px; margin-left: 15px; border: 1px solid #007bff; font-weight: 500; }

    .pending-withdraw-notice { padding: 15px; margin-bottom: 20px; background-color: #21262d; border: 1px solid var(--theme-color); color: var(--theme-color); border-radius: 8px; text-align: center; font-size: 14px; }
    .modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,0.7);display:flex;justify-content:center;align-items:center;z-index:1000;transition:opacity .3s}
    .modal-content{background:#161b22;padding:25px;border-radius:12px;max-width:400px;width:90%;text-align:center;box-shadow:0 8px 24px rgba(0,0,0,0.5);transform:scale(.9);transition:transform .3s; color: #c9d1d9;} 
    .modal-overlay.hidden{display:none}.modal-overlay:not(.hidden) .modal-content{transform:scale(1)}.error-message{color:#e74c3c;font-size:14px;text-align:center;margin-bottom:10px;min-height:16px}
    .balance-display-card{background: var(--theme-gradient); color:#161b22;padding:20px;border-radius:12px;margin-bottom:20px}
    .balance-display-card p{margin:0;font-size:14px; color: #161b22;}.balance-display-card h2{color:#161b22;text-align:left;margin:5px 0 0}.payment-method-selector{display:flex;gap:15px;margin-bottom:20px}.payment-method-btn{flex-grow:1;background-color:#21262d;border:2px solid #30363d;color:#c9d1d9;padding:15px;border-radius:8px;font-size:16px;cursor:pointer}.payment-method-btn.selected{border-color:var(--theme-color);color:var(--theme-color)}.input-section{background-color:#21262d;padding:15px;border-radius:8px;margin-bottom:15px}.input-section p{margin:0 0 10px;font-weight:700;font-size:14px;text-align:left; color: #c9d1d9;}.input-wrapper{position:relative;display:flex;align-items:center}#wallet-page .input-wrapper input{background-color:transparent;border:none;border-bottom:1px solid #30363d;padding:10px 0;font-size:18px;width:100%;color:#c9d1d9}#wallet-page .input-wrapper input:focus{color:#f8d44c;outline:0;border-bottom-color:var(--theme-color)}.all-btn-inside{position:absolute;right:5px;background-color:#30363d;color:var(--theme-color);border:none;border-radius:6px;padding:5px 10px;font-size:12px;cursor:pointer}.withdrawable-info{color:#8b949e;font-size:14px;margin:20px 0;text-align:left}.withdrawable-info span{color:#c9d1d9;font-weight:700}
    .btn-withdraw-unique{background:var(--theme-gradient);color:#161b22;font-weight:700;font-size:18px;border-radius:12px;box-shadow:0 4px 15px rgba(240,185,11,.2)}.history-item{background-color:#21262d;padding:15px;border-radius:8px;margin-bottom:10px}.history-main-info{display:flex;justify-content:space-between;align-items:center}.history-details p{margin:2px 0;font-size:14px; color: #c9d1d9;}.history-status{font-weight:700;padding:4px 10px;border-radius:15px;font-size:12px}.status-pending{background-color:var(--theme-color);color:#161b22}.status-completed{background-color:#43a047;color:#fff}.status-rejected{background-color:#d83f3f;color:#fff}.notice-message{font-size:12px;text-align:center;margin-top:10px;padding-top:10px;border-top:1px solid #30363d}.pending-notice{color:var(--theme-color)}.rejected-notice{color:#e74c3c}.vip-plans-container{display:grid;grid-template-columns:1fr;gap:20px}.vip-plan-card{background:linear-gradient(135deg,#2a2d34,#161b22);border:1px solid var(--theme-color);border-radius:12px;padding:20px;text-align:center;box-shadow:0 4px 20px rgba(0,0,0,.4)}.vip-plan-card h4{margin:0 0 15px;font-size:22px;color:#f8d44c}.vip-plan-card .price{font-size:28px;font-weight:700;color:#fff;margin-bottom:20px}.vip-plan-details{text-align:left;margin-bottom:20px;color:#8b949e}.vip-plan-details p{margin:8px 0;display:flex;justify-content:space-between}.vip-plan-details span{color:#c9d1d9;font-weight:500}.plan-action-container{margin-top:20px;min-height:45px}.plan-status-display{padding:12px;border-radius:8px;font-size:16px;font-weight:600}.plan-status-display.pending{background-color:var(--theme-color);color:#161b22}.plan-status-display.active{background-color:#43a047;color:#fff}.vip-payment-methods{display:flex;justify-content:center;gap:15px;margin:20px 0}.vip-payment-methods label{cursor:pointer;padding:10px 20px;border:2px solid #30363d;border-radius:8px;color:#c9d1d9;transition:all .2s}.vip-payment-methods input[type=radio]{display:none}.vip-payment-methods input[type=radio]:checked+label{border-color:var(--theme-color);color:var(--theme-color);background-color:#21262d}.copy-btn{background-color:#30363d;color:var(--theme-color);border:none;border-radius:8px;padding:6px 14px;font-size:14px;font-weight:500;cursor:pointer;margin-left:12px;font-family:'Roboto',sans-serif;vertical-align:middle;transition:background-color .2s}.copy-btn:hover{background-color:#454c56}
    #vip-page-notice { background-color: #21262d; border: 1px solid var(--theme-color); color: var(--theme-color); padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: center; }
    .plan-active-notice { font-size: 12px; color: #8b949e; margin-top: 8px; text-align: center; }
    #me-page { padding: 0; background-color: #f4f4f8; }
    .me-page-header { background: var(--theme-gradient); padding: 25px 20px 80px 20px; text-align: center; border-bottom-left-radius: 40px; border-bottom-right-radius: 40px; position: relative; }
    .me-page-avatar { width: 90px; height: 90px; border-radius: 50%; border: 4px solid #fff; box-shadow: 0 4px 12px rgba(0,0,0,0.2); object-fit: cover; margin-bottom: 12px; }
    .me-page-content-wrapper { margin: -60px 20px 0px 20px; position: relative; z-index: 2; padding-bottom: 20px; }
    .me-name-box { background: rgba(255, 255, 255, 0.25); backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); border: 1px solid rgba(255, 255, 255, 0.4); border-radius: 50px; padding: 8px 25px; font-size: 18px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); display: inline-block; }
    .me-name-label { color: #fff; font-weight: 500; opacity: 0.9; text-shadow: 1px 1px 2px rgba(0,0,0,0.2); }
    .me-name-value { color: #fff; font-weight: 700; margin-left: 8px; text-shadow: 1px 1px 2px rgba(0,0,0,0.2); }
    .me-social-links { display: flex; justify-content: space-around; background-color: #ffffff; border-radius: 20px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 20px; }
    .me-social-btn { display: flex; flex-direction: column; align-items: center; text-decoration: none; color: #333; font-size: 14px; font-weight: 600; gap: 8px; }
    .me-social-btn .social-icon-wrapper { background-color: #ffffff; border: 1px solid #f0f0f0; width: 60px; height: 60px; border-radius: 18px; display: flex; justify-content: center; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.08); }
    .me-social-btn img { width: 32px; height: 32px; }
    .me-details-list { display: flex; flex-direction: column; gap: 12px; margin-bottom: 25px; }
    .me-detail-item-box { background-color: #fff; border-radius: 12px; padding: 15px; display: flex; justify-content: space-between; align-items: center; font-size: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
    .me-detail-label { color: #555; font-weight: 500; }
    .me-detail-value { color: #111; font-weight: 700; }
    .me-actions { display: flex; gap: 15px; padding: 0 10px; }
    .me-action-btn { flex: 1; padding: 12px; border: none; border-radius: 25px; font-size: 15px; font-weight: 600; cursor: pointer; display: flex; justify-content: center; align-items: center; gap: 8px; box-shadow: 0 3px 8px rgba(0,0,0,0.1); transition: transform 0.2s; }
    .me-action-btn:hover { transform: translateY(-2px); }
    .me-edit-btn { background-color: #ffc107; color: #fff; }
    .me-logout-btn { background-color: #ff5252; color: #fff; }

    .me-page-greeting {
        position: absolute;
        top: 45px;
        right: 25px;
        font-size: 48px;
        font-weight: 900;
        color: rgba(255, 255, 255, 0.5);
        transform: rotate(-15deg);
        text-shadow: 2px 2px 5px rgba(0,0,0,0.15);
        margin: 0;
        pointer-events: none;
    }

    /* Game Page Styles */
    .game-page { position: relative; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; padding-top: 70px; height: 100%; box-sizing: border-box; background-color: #1a1a2e; }
    .game-page-header { position: absolute; top: 15px; left: 15px; right: 15px; display: flex; justify-content: space-between; align-items: center; z-index: 20; }
    .game-back-btn { padding: 0 15px; height: 40px; background-color: rgba(44, 83, 100, 0.7); border: 1px solid var(--theme-color); border-radius: 20px; display: flex; justify-content: center; align-items: center; cursor: pointer; color: #fff; font-size: 14px; font-weight: bold; transition: background-color 0.2s; }
    .game-back-btn:hover { background-color: #3a6a7e; }
    .game-coin-display { background-color: rgba(255, 152, 0, 0.7); color: #fff; padding: 8px 16px; border-radius: 20px; font-weight: 600; display: flex; align-items: center; }
    .game-coin-display img { width: 20px; height: 20px; margin-right: 8px; }
    .game-title { background: #21262d; color: #f8d44c; padding: 10px 30px; border-radius: 50px; font-size: 20px; font-weight: 700; margin-bottom: 20px; border: 2px solid var(--theme-color); box-shadow: 0 2px 15px rgba(240, 185, 11, 0.2); text-shadow: 0 0 5px rgba(240, 185, 11, 0.3); flex-shrink: 0; }
    .game-count-display { font-size: 16px; color: #8b949e; margin-bottom: 20px; text-align: center; flex-shrink: 0; }
    
    /* Spin Wheel Specifics */
    .wheel-container { position: relative; width: 300px; height: 300px; margin-bottom: 30px; border-radius: 50%; display: flex; justify-content: center; align-items: center; border: 8px solid transparent; background: linear-gradient(#161b22, #161b22) padding-box, conic-gradient(from 180deg at 50% 50%, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3) border-box; box-shadow: 0 0 20px rgba(240, 185, 11, 0.4); }
    #spin-canvas { width: 100%; height: 100%; }
    .wheel-container::after { content: ''; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 20px; height: 20px; background: #161b22; border-radius: 50%; border: 4px solid var(--theme-color); z-index: 11; box-shadow: inset 0 0 5px rgba(0,0,0,0.5); }
    .spin-pointer { position: absolute; top: -8px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 20px solid transparent; border-right: 20px solid transparent; border-top: 30px solid var(--theme-color); z-index: 10; filter: drop-shadow(0 -2px 2px rgba(0,0,0,0.3)); }
    #spin-btn { width: 100px; height: 100px; padding: 0; font-size: 24px; border-radius: 50%; }
    #spin-btn:disabled { background-color: #30363d; color: #8b949e; cursor: not-allowed; }

    /* Solve Math Specifics */
    .math-problem-container { background: linear-gradient(135deg, #2a2d34, #161b22); border: 1px solid var(--theme-color); box-shadow: 0 0 15px rgba(240, 185, 11, 0.3); padding: 25px; border-radius: 12px; margin-bottom: 25px; width: 90%; text-align: center; }
    #math-problem-text { font-size: 28px; font-weight: bold; color: #f8d44c; }
    #math-options-container { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 90%; margin-bottom: 25px; }
    .math-option-btn { background: linear-gradient(135deg, #2c5364, #203a43); border: 1px solid #00aaff; box-shadow: 0 0 10px rgba(0, 170, 255, 0.3); color: #fff; font-size: 20px; font-weight: bold; padding: 15px; border-radius: 10px; cursor: pointer; transition: all 0.2s; }
    .math-option-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(0, 170, 255, 0.5); }
    .math-option-btn.correct { background: #4CAF50; border-color: #fff; }
    .math-option-btn.wrong { background: #D0021B; border-color: #ff0000; }
    
    /* Watch Ads Page Styles */
    #watch-ads-page .game-title { margin-bottom: 10px; } 
    .ad-task-list-container { display: flex; flex-direction: column; gap: 12px; width: 100%; max-width: 340px; margin: 0 auto; flex-grow: 1; overflow-y: auto; padding-bottom: 15px;}
    .ad-task-item { display: flex; justify-content: space-between; align-items: center; background-color: #21262d; padding: 15px; border-radius: 8px; border-left: 5px solid var(--theme-color); }
    .ad-task-item p { margin: 0; font-size: 16px; color: #c9d1d9; font-weight: 500; }
    .btn-watch-ad { background: var(--theme-gradient); color: #161b22; padding: 8px 18px; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; min-width: 80px; text-align: center;}
    .btn-watch-ad:disabled { background: #43a047; color: white; cursor: not-allowed; }
    #ad-modal-content { display: flex; flex-direction: column; gap: 20px; }
    #ad-container { min-height: 250px; width: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; background: #0d1117; border-radius: 8px; padding: 20px; box-sizing: border-box;}
    
    /* Quiz Page Styles */
    .quiz-question-container { background: linear-gradient(135deg, #2a2d34, #161b22); border: 1px solid var(--theme-color); box-shadow: 0 0 15px rgba(240, 185, 11, 0.3); padding: 25px; border-radius: 12px; margin-bottom: 25px; width: 90%; text-align: center; min-height: 60px; display: flex; align-items: center; justify-content: center;}
    #quiz-question-text, #bangla-quiz-question-text { font-size: 20px; font-weight: bold; color: #f8d44c; }
    #quiz-options-container, #bangla-quiz-options-container { display: grid; grid-template-columns: 1fr; gap: 12px; width: 90%; margin-bottom: 25px; }
    .quiz-option-btn { background: linear-gradient(135deg, #2c5364, #203a43); border: 1px solid #00aaff; box-shadow: 0 0 10px rgba(0, 170, 255, 0.3); color: #fff; font-size: 18px; font-weight: bold; padding: 15px; border-radius: 10px; cursor: pointer; transition: all 0.2s; text-align: left;}
    .quiz-option-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(0, 170, 255, 0.5); }
    .quiz-option-btn:disabled { cursor: not-allowed; opacity: 0.7; }
    .quiz-option-btn.correct { background: #4CAF50; border-color: #fff; color: #fff; }
    .quiz-option-btn.wrong { background: #D0021B; border-color: #ff0000; color: #fff;}

    /* Scratch Card Styles (UPDATED) */
    #scratch-card-page { position: relative; }
    #scratch-card-container { position: relative; width: 300px; height: 180px; border-radius: 10px; background: var(--theme-gradient); display: flex; justify-content: center; align-items: center; cursor: pointer; -webkit-user-select: none; user-select: none; border: 2px solid #fff; box-shadow: 0 4px 15px rgba(0,0,0,0.2);}
    #scratch-prize-display { color: #161b22; font-size: 24px; font-weight: bold; text-align: center;}
    #scratch-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-radius: 10px; cursor: grab; }
    #scratch-canvas:active { cursor: grabbing; }
    #scratch-cursor { position: absolute; display: none; width: 25px; height: 25px; border-radius: 50%; background-color: rgba(255, 255, 255, 0.2); border: 2px solid rgba(255, 255, 255, 0.5); transform: translate(-50%, -50%); pointer-events: none; z-index: 100; }

    /* Modal Input Styles */
    .modal-content .input-section { margin-bottom: 20px; }
    .modal-content .input-wrapper input {
        background-color: transparent;
        border: none;
        border-bottom: 2px solid #30363d;
        color: #c9d1d9;
        width: 100%;
        padding: 10px 0;
        font-size: 20px;
        text-align: center;
        box-sizing: border-box;
        transition: border-color 0.3s;
    }
    .modal-content .input-wrapper input:focus {
        outline: none;
        border-bottom-color: var(--theme-color);
    }

    /* Specific Modal Adjustments */
    #exchange-result { margin-top: 15px; font-size: 18px; color: var(--theme-color); font-weight: bold; min-height: 25px;}

    /* Scrolling Fixes */
    #vip-task-page, #history-page, #vip-page {display: flex; flex-direction: column; height: 100%; overflow: hidden; padding: 20px 20px 0 20px;}
    #vip-task-page .page-header, #history-page .page-header, #vip-page .page-header, #vip-page #vip-page-notice {flex-shrink: 0; padding-bottom: 15px;}
    #vip-task-active-plan, #vip-task-no-plan {flex-grow: 1; display: flex; flex-direction: column; overflow: hidden;}
    #vip-task-active-plan .active-plan-header {flex-shrink: 0;}
    #vip-task-container, #history-list, .vip-plans-container {flex-grow: 1; overflow-y: auto; padding-bottom: 20px; padding-right: 5px;}
    
    @media (max-width: 480px) { body { height: 100vh; overflow: hidden; } .container, #auth-section { border-radius: 0; border: none; min-height: 100vh; } }
</style>

</head>
<body>

<div class="container hidden" id="user-panel-wrapper">
    <div id="user-panel">
        <div id="pages-container">
            <!-- Home Page -->
            <div id="home-page">
                <div class="header-card"><div class="user-info"><img id="header-user-avatar" src="" alt="User"><div class="user-details"><h3 id="user-name-display">Hi, User</h3><p>Welcome</p></div></div><div class="balance-card">‡ß≥ <span id="user-balance">0</span></div></div>
                <div id="coin-wallet-section">
                    <div class="coin-balance-display">
                        <p>Coin Wallet</p>
                        <h4><img src="https://cdn-icons-png.flaticon.com/512/138/138233.png" alt="coin"> <span id="home-coin-balance">0</span></h4>
                    </div>
                    <button id="exchange-coins-btn">Exchange</button>
                </div>
                <div class="task-grid">
                    <div class="task-item" onclick="openSpinWheel()"><div class="icon">üé°</div><p>Spin Wheel</p></div>
                    <div class="task-item" onclick="openSolveMath()"><div class="icon">üßÆ</div><p>Solve Math</p></div>
                    <div class="task-item" onclick="openWatchAdsPage()"><div class="icon">üì∫</div><p>Watch Ads</p></div>
                    <div class="task-item" onclick="openQuizGame()"><div class="icon">‚ùì</div><p>Quiz</p></div>
                    <div class="task-item" onclick="openBanglaQuiz()"><div class="icon">üáßüá©</div><p>Bangla Quiz</p></div>
                    <div class="task-item" onclick="openScratchCard()"><div class="icon">üé´</div><p>Scratch Card</p></div>
                </div>
            </div>

            <!-- Spin Wheel Page -->
            <div id="spin-wheel-page" class="main-content hidden game-page">
                <div class="game-page-header"><div class="game-back-btn" onclick="switchPage('home-page')">BACK</div><div class="game-coin-display"><img src="https://cdn-icons-png.flaticon.com/512/138/138233.png" alt="coin"><span id="spin-coin-display">0</span></div></div>
                <h3 class="game-title">Spin To Win</h3>
                <div class="wheel-container"><div class="spin-pointer"></div><canvas id="spin-canvas" width="284" height="284"></canvas></div>
                <p id="spin-count-display" class="game-count-display">Today's Spins Remaining: 0/0</p>
                <button id="spin-btn" class="btn">SPIN</button>
            </div>

            <!-- Solve Math Page -->
            <div id="solve-math-page" class="main-content hidden game-page">
                <div class="game-page-header"><div class="game-back-btn" onclick="switchPage('home-page')">BACK</div><div class="game-coin-display"><img src="https://cdn-icons-png.flaticon.com/512/138/138233.png" alt="coin"><span id="math-coin-display">0</span></div></div>
                <h3 class="game-title">Solve The Math</h3>
                <div class="math-problem-container"><span id="math-problem-text">15 + 7 = ?</span></div>
                <div id="math-options-container"></div>
                <p id="math-count-display" class="game-count-display">Today's Tasks Remaining: 0/0</p>
            </div>

            <!-- Quiz Page -->
            <div id="quiz-page" class="main-content hidden game-page">
                <div class="game-page-header"><div class="game-back-btn" onclick="switchPage('home-page')">BACK</div><div class="game-coin-display"><img src="https://cdn-icons-png.flaticon.com/512/138/138233.png" alt="coin"><span id="quiz-coin-display">0</span></div></div>
                <h3 class="game-title">General Knowledge Quiz</h3>
                <div class="quiz-question-container"><span id="quiz-question-text">Loading question...</span></div>
                <div id="quiz-options-container"></div>
                <p id="quiz-count-display" class="game-count-display">Today's Questions Remaining: 0/0</p>
            </div>
            
            <!-- Bangla Quiz Page -->
            <div id="bangla-quiz-page" class="main-content hidden game-page">
                <div class="game-page-header"><div class="game-back-btn" onclick="switchPage('home-page')">BACK</div><div class="game-coin-display"><img src="https://cdn-icons-png.flaticon.com/512/138/138233.png" alt="coin"><span id="bangla-quiz-coin-display">0</span></div></div>
                <h3 class="game-title">Bangla Quiz</h3>
                <div class="quiz-question-container"><span id="bangla-quiz-question-text">Loading question...</span></div>
                <div id="bangla-quiz-options-container"></div>
                <p id="bangla-quiz-count-display" class="game-count-display">Today's Quizzes Remaining: 0/0</p>
            </div>
            
            <!-- Scratch Card Page (NEW) -->
            <div id="scratch-card-page" class="main-content hidden game-page">
                <div id="scratch-cursor"></div>
                <div class="game-page-header"><div class="game-back-btn" onclick="switchPage('home-page')">BACK</div><div class="game-coin-display"><img src="https://cdn-icons-png.flaticon.com/512/138/138233.png" alt="coin"><span id="scratch-coin-display">0</span></div></div>
                <h3 class="game-title">Scratch & Win</h3>
                <div id="scratch-card-container">
                    <div id="scratch-prize-display"></div>
                    <canvas id="scratch-canvas" width="300" height="180"></canvas>
                </div>
                <p id="scratch-count-display" class="game-count-display">Today's Cards Remaining: 0/0</p>
            </div>
    
            <!-- Watch Ads Page -->
            <div id="watch-ads-page" class="main-content hidden game-page">
                <div class="game-page-header"><div class="game-back-btn" onclick="switchPage('home-page')">BACK</div><div class="game-coin-display"><img src="https://cdn-icons-png.flaticon.com/512/138/138233.png" alt="coin"><span id="ads-coin-display">0</span></div></div>
                <h3 class="game-title">Watch Ads & Earn</h3>
                <p id="ad-task-count-display" class="game-count-display">Today's Ads Remaining: 0/0</p>
                <div id="ad-task-list" class="ad-task-list-container"></div>
            </div>

            <!-- VIP Task Page -->
            <div id="vip-task-page" class="main-content hidden">
                <div class="page-header"><h3>VIP Daily Tasks</h3></div>
                <div id="vip-task-active-plan" class="hidden">
                    <div class="active-plan-header"><span id="active-plan-name" class="plan-name-display"></span><span class="plan-status-badge">Active</span></div>
                    <div id="vip-task-container"></div>
                </div>
                <div id="vip-task-no-plan" class="no-plan-container hidden">
                    <h3>No Active Plan</h3><p>You do not have an active VIP plan. To start earning, please purchase a plan.</p><button id="buy-plan-now-btn" class="btn">Buy a Plan Now</button>
                </div>
            </div>

            <!-- VIP Plan Page -->
            <div id="vip-page" class="main-content hidden">
                <div class="page-header"><h3>VIP Plans</h3></div><div id="vip-page-notice" class="hidden"></div>
                 <!-- ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶á‡¶®‡¶æ‡¶∞‡¶ü‡¶ø ‡¶°‡¶æ‡¶á‡¶®‡¶æ‡¶Æ‡¶ø‡¶ï‡¶≠‡¶æ‡¶¨‡ßá ‡¶ú‡¶æ‡¶≠‡¶æ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü ‡¶¶‡ßç‡¶¨‡¶æ‡¶∞‡¶æ ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá -->
                <div class="vip-plans-container" id="vip-plans-container-dynamic">
                    <p style="text-align:center; color: #8b949e;">Loading VIP plans...</p>
                </div>
            </div>
            
            <!-- Wallet Page -->
            <div id="wallet-page" class="main-content hidden">
                <div class="page-header"><h3>Withdraw</h3><a id="withdrawal-history-link" class="action-link">History</a></div>
                <div id="pending-withdraw-notice" class="pending-withdraw-notice hidden">You previous withdrawal request is being processed. You cannot make a new request until it is completed.</div>
                <div class="balance-display-card"><p>Available balance</p><h2>‡ß≥<span id="wallet-balance">0.00</span></h2></div>
                <div id="withdraw-content">
                    <div class="payment-method-selector"><button id="select-bkash-btn" class="payment-method-btn selected">bKash</button><button id="select-nagad-btn" class="payment-method-btn">Nagad</button></div>
                    <div id="bkash-withdraw-form">
                        <div class="input-section"><p>BKASH Account</p><div class="input-wrapper"><input type="text" id="bkash-number" placeholder="01xxxxxxxxx"></div></div>
                        <div class="input-section"><p>Amount</p><div class="input-wrapper"><input type="number" id="bkash-amount" placeholder="0"><button id="bkash-all-btn" class="all-btn-inside">ALL</button></div></div>
                        <p class="withdrawable-info">Withdrawable: <span>‡ß≥<span id="bkash-withdrawable-balance">0.00</span></span> (<span id="bkash-min-max-info"></span>)</p>
                        <button id="bkash-withdraw-btn" class="btn btn-withdraw-unique">Withdraw</button>
                    </div>
                    <div id="nagad-withdraw-form" class="hidden">
                        <div class="input-section"><p>NAGAD Account</p><div class="input-wrapper"><input type="text" id="nagad-number" placeholder="01xxxxxxxxx"></div></div>
                        <div class="input-section"><p>Amount</p><div class="input-wrapper"><input type="number" id="nagad-amount" placeholder="0"><button id="nagad-all-btn" class="all-btn-inside">ALL</button></div></div>
                         <p class="withdrawable-info">Withdrawable: <span>‡ß≥<span id="nagad-withdrawable-balance">0.00</span></span> (<span id="nagad-min-max-info"></span>)</p>
                        <button id="nagad-withdraw-btn" class="btn btn-withdraw-unique">Withdraw</button>
                    </div>
                </div>
            </div>
            
            <!-- History Page -->
            <div id="history-page" class="main-content hidden">
                <div class="page-header">
                    <button id="back-to-wallet-btn" class="back-btn" aria-label="Back"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg></button>
                    <h3>Withdrawal History</h3>
                </div>
                <div id="history-list"><p style="text-align: center; color: #8b949e;">No history found.</p></div>
            </div>

            <!-- Me/My Account Page -->
            <div id="me-page" class="hidden">
                <div class="me-page-header">
                    <img src="" class="me-page-avatar" id="me-page-avatar">
                    <div class="me-name-box"><span class="me-name-label">Name:</span><span class="me-name-value" id="me-page-username">Username</span></div>
                    <h1 class="me-page-greeting">Hello</h1>
                </div>
                <div class="me-page-content-wrapper">
                    <div class="me-social-links">
                        <a id="tiktok-link" href="#" target="_blank" rel="noopener noreferrer" class="me-social-btn"><div class="social-icon-wrapper"><img src="https://cdn-icons-png.flaticon.com/512/3046/3046120.png" alt="TikTok"></div><span>Follow Now</span></a>
                        <a id="youtube-link" href="#" target="_blank" rel="noopener noreferrer" class="me-social-btn"><div class="social-icon-wrapper"><img src="https://cdn-icons-png.flaticon.com/512/1384/1384060.png" alt="YouTube"></div><span>Subscribe</span></a>
                        <a id="telegram-link" href="#" target="_blank" rel="noopener noreferrer" class="me-social-btn"><div class="social-icon-wrapper"><img src="https://upload.wikimedia.org/wikipedia/commons/8/82/Telegram_logo.svg" alt="Telegram"></div><span>Support</span></a>
                    </div>
                    <div class="me-details-list">
                        <div class="me-detail-item-box"><span class="me-detail-label">Balance:</span><span class="me-detail-value">‡ß≥ <span id="me-total-tk">0</span></span></div>
                        <div class="me-detail-item-box"><span class="me-detail-label">Plan</span><span class="me-detail-value" id="me-plan-name">Free</span></div>
                        <div class="me-detail-item-box"><span class="me-detail-label">UID</span><span class="me-detail-value" id="me-user-uid">0000</span></div>
                        <div class="me-detail-item-box"><span class="me-detail-label">Gmail</span><span class="me-detail-value" id="me-user-gmail">user@gmail.com</span></div>
                        <div class="me-detail-item-box"><span class="me-detail-label">Total Income</span><span class="me-detail-value">‡ß≥ <span id="me-total-income">0</span></span></div>
                    </div>
                    <div class="me-actions">
                        <button class="me-action-btn me-edit-btn" id="me-edit-profile-btn">Edit Profile</button>
                        <button class="me-action-btn me-logout-btn" id="me-logout-btn">Log Out</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="bottom-nav" class="bottom-nav">
            <div id="nav-home" class="nav-item active">
                <img src="https://cdn-icons-png.flaticon.com/512/25/25694.png" alt="Home">
                <span>Home</span>
            </div>
            <div id="nav-vip" class="nav-item">
                <img src="https://img.icons8.com/ios-filled/64/000000/crown.png" alt="VIP">
                <span>VIP</span>
            </div>
            <div id="nav-task" class="nav-item">
                <img src="https://img.icons8.com/ios-filled/64/000000/todo-list.png" alt="Task">
                <span>Task</span>
            </div>
            <div id="nav-wallet" class="nav-item">
                <img src="https://img.icons8.com/ios-filled/64/000000/wallet.png" alt="Withdraw">
                <span>Withdraw</span>
            </div>
            <div id="nav-me" class="nav-item">
                <img src="https://cdn-icons-png.flaticon.com/512/1077/1077114.png" alt="Me">
                <span>Me</span>
            </div>
        </div>
    </div>
</div>

<div id="auth-section">
    <div class="main">
        <input type="checkbox" id="chk" aria-hidden="true">

        <div class="signup">
            <form>
                <label for="chk" aria-hidden="true">Register</label>
                <p id="register-error-message" class="auth-error-message"></p>
                <div class="input-container">
                    <i class="fas fa-envelope"></i>
                    <input type="email" name="email" placeholder="Email" required="" id="register-email">
                </div>
                <div class="input-container">
                    <i class="fas fa-lock"></i>
                    <input type="password" name="pswd" placeholder="Password" required="" id="register-password">
                </div>
                <div class="input-container">
                    <i class="fas fa-lock"></i>
                    <input type="password" name="pswd-confirm" placeholder="Confirm Password" required="" id="register-confirm-password">
                </div>
                <button type="button" id="register-btn">Register</button>
            </form>
        </div>

        <div class="login">
            <form>
                <label for="chk" aria-hidden="true">Login</label>
                 <p id="login-error-message" class="auth-error-message"></p>
                <div class="input-container">
                    <i class="fas fa-envelope"></i>
                    <input type="email" name="email" placeholder="Email" required="" id="login-email">
                </div>
                <div class="input-container">
                    <i class="fas fa-lock"></i>
                    <input type="password" name="pswd" placeholder="Password" required="" id="login-password">
                </div>
                <button type="button" id="login-btn">Login</button>
            </form>
        </div>
    </div>
</div>

<div id="payment-modal" class="modal-overlay hidden"><div class="modal-content"><h3>Complete Your Purchase</h3><p>Please send <strong id="plan-price-display"></strong> Taka to the number below.</p><div style="background-color: #21262d; padding: 15px; border-radius: 8px; margin: 15px 0;"><p id="vip-bkash-number-display" style="margin: 0;">Personal bKash: <strong style="font-size: 18px;" id="bkash-payment-number">01850267366</strong><button class="copy-btn" id="copy-bkash-btn">Copy</button></p><p id="vip-nagad-number-display" class="hidden" style="margin: 0;">Personal Nagad: <strong style="font-size: 18px;" id="nagad-payment-number">01632871125</strong><button class="copy-btn" id="copy-nagad-btn">Copy</button></p></div><p>Which medium did you use to send money?</p><div class="vip-payment-methods"><input type="radio" id="vip-bkash" name="vip-payment-method" value="bKash" checked><label for="vip-bkash">bKash</label><input type="radio" id="vip-nagad" name="vip-payment-method" value="Nagad"><label for="vip-nagad">Nagad</label></div><p>Enter the Transaction ID (TrxID) below after sending the money:</p><div class="input-section" style="margin-top: 10px;"><div class="input-wrapper"><input type="text" id="transaction-id-input" placeholder="Enter Transaction ID"></div></div><button id="verify-payment-btn" class="btn" style="margin-top: 20px;">Verify Payment</button><button id="close-payment-modal-btn" class="btn" style="margin-top: 10px; background-color: #555;">Cancel</button></div></div>
<div id="username-modal" class="modal-overlay hidden"><div class="modal-content"><h3>Change Your Name</h3><p style="color: #c9d1d9; font-size: 14px; margin-top: 10px; margin-bottom: 20px;">Enter your new name and save.</p><div class="input-section"><div class="input-wrapper"><input type="text" id="modal-username-input" placeholder="New Name"></div></div><button id="modal-save-username-btn" class="btn">Save</button><button id="modal-cancel-username-btn" class="btn" style="margin-top: 10px; background-color: #555;">Cancel</button></div></div>
<div id="ad-modal" class="modal-overlay hidden"><div class="modal-content" id="ad-modal-content"></div></div>
<div id="exchange-modal" class="modal-overlay hidden"><div class="modal-content"><h3>Exchange Coins</h3><p id="exchange-rate-info">1000 Coins = ‡ß≥0</p><div class="input-section"><p id="min-exchange-info">Enter coins to exchange (min: 0)</p><div class="input-wrapper"><input type="number" id="exchange-coin-input" placeholder="0"></div></div><div id="exchange-result">You will get: ‡ß≥0.00</div><button id="confirm-exchange-btn" class="btn" style="margin-top: 20px;">Confirm Exchange</button><button id="cancel-exchange-btn" class="btn" style="margin-top: 10px; background-color: #555;">Cancel</button></div></div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDF1DB20sO_parYJx93TgFNXZRK1M6o2-Q",
        authDomain: "taka-bd1d6.firebaseapp.com",
        databaseURL: "https://taka-bd1d6-default-rtdb.firebaseio.com",
        projectId: "taka-bd1d6",
        storageBucket: "taka-bd1d6.appspot.com",
        messagingSenderId: "106403122369",
        appId: "1:106403122369:web:5f01addd08ec1ed1d0d840"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();
    
    let appSettings = {}; 
    let vipPlans = {}; 
    
    let currentUserData = {};
    let selectedPlanPrice = 0;
    let selectedPlanName = '';
    let countdownInterval = null;

    const authSection = document.getElementById('auth-section'); 
    const userPanelWrapper = document.getElementById('user-panel-wrapper'); 
    const vipTaskActivePlanDiv = document.getElementById('vip-task-active-plan');
    const vipTaskNoPlanDiv = document.getElementById('vip-task-no-plan');
    const activePlanNameSpan = document.getElementById('active-plan-name');
    const vipTaskContainer = document.getElementById('vip-task-container');
    const pages = document.querySelectorAll('#pages-container > div');
    const navItems = document.querySelectorAll('.nav-item');
    const bottomNav = document.getElementById('bottom-nav');
    
    const vipAdScripts = [
        // Ad 1
        `<script type="text/javascript">
        atOptions = {
            'key' : '451aa94f945dcca806d0a85086c71269',
            'format' : 'iframe',
            'height' : 250,
            'width' : 300,
            'params' : {}
        };
        <\/script>
        <script type="text/javascript" src="//www.highperformanceformat.com/451aa94f945dcca806d0a85086c71269/invoke.js"><\/script>`,
        // Ad 2
        `<script type="text/javascript">
        atOptions = {
            'key' : '6161f56d50d2bc6a30b0b07c52c5c7f7',
            'format' : 'iframe',
            'height' : 90,
            'width' : 728,
            'params' : {}
        };
        <\/script>
        <script type="text/javascript" src="//www.highperformanceformat.com/6161f56d50d2bc6a30b0b07c52c5c7f7/invoke.js"><\/script>`,
        // Ad 3
        `<script type="text/javascript">
        atOptions = {
            'key' : 'c7bd57eab3c81f9f1d602bfc3495cbe0',
            'format' : 'iframe',
            'height' : 600,
            'width' : 160,
            'params' : {}
        };
        <\/script>
        <script type="text/javascript" src="//www.highperformanceformat.com/c7bd57eab3c81f9f1d602bfc3495cbe0/invoke.js"><\/script>`,
        // Ad 4
        `<script type="text/javascript">
        atOptions = {
            'key' : 'b018990e2fbb77c0bfe16b171ca9eb46',
            'format' : 'iframe',
            'height' : 300,
            'width' : 160,
            'params' : {}
        };
        <\/script>
        <script type="text/javascript" src="//www.highperformanceformat.com/b018990e2fbb77c0bfe16b171ca9eb46/invoke.js"><\/script>`,
        // Ad 5
        `<script type="text/javascript">
        atOptions = {
            'key' : '9139deac106c705fbfbd76be3e898dac',
            'format' : 'iframe',
            'height' : 60,
            'width' : 468,
            'params' : {}
        };
        <\/script>
        <script type="text/javascript" src="//www.highperformanceformat.com/9139deac106c705fbfbd76be3e898dac/invoke.js"><\/script>`,
        // Ad 6
        `<script type='text/javascript' src='//pl27219363.profitableratecpm.com/eb/d8/2f/ebd82f454f83231f3b3bf56ba8ba496c.js'><\/script>`,
        // Ad 7 (URL)
        `https://www.profitableratecpm.com/ghahb2wm?key=6f34e2146d2493212da93a19e15f4593`,
        // Ad 8
        `<script type='text/javascript' src='//pl27232786.profitableratecpm.com/8a/af/c1/8aafc117de8b280c6849e444035a2834.js'><\/script>`,
        // Ad 9
        `<script type="text/javascript">
        atOptions = {
            'key' : 'adbba2fe14c8e73fe488b00b74783fcb',
            'format' : 'iframe',
            'height' : 50,
            'width' : 320,
            'params' : {}
        };
        <\/script>
        <script type="text/javascript" src="//www.highperformanceformat.com/adbba2fe14c8e73fe488b00b74783fcb/invoke.js"><\/script>`,
        // Ad 10
        `<script async="async" data-cfasync="false" src="//pl27232783.profitableratecpm.com/54842c5696f14d3db414d396a4da03c8/invoke.js"><\/script>
        <div id="container-54842c5696f14d3db414d396a4da03c8"></div>`
    ];

    // --- START: Load Settings and Plans from Admin ---
    async function loadAppSettings() {
        const settingsRef = db.ref('settings');
        const snapshot = await settingsRef.once('value');
        if (snapshot.exists()) {
            appSettings = snapshot.val();
            applyAppSettings();
        }
    }

    function applyAppSettings() {
        // Theme Color
        const root = document.documentElement;
        if (appSettings.themeColors && appSettings.themeColors.length > 0) {
            const colors = appSettings.themeColors;
            root.style.setProperty('--theme-color', colors[0]);
            if (colors.length > 1) {
                root.style.setProperty('--theme-gradient', `linear-gradient(90deg, ${colors.join(', ')})`);
            } else {
                 root.style.setProperty('--theme-gradient', colors[0]);
            }
        }
        
        // Hello Text
        if (appSettings.helloText) {
            document.querySelector('.me-page-greeting').textContent = appSettings.helloText;
        }
        // Social Links
        if (appSettings.tiktokLink) document.getElementById('tiktok-link').href = appSettings.tiktokLink;
        if (appSettings.youtubeLink) document.getElementById('youtube-link').href = appSettings.youtubeLink;
        if (appSettings.telegramLink) document.getElementById('telegram-link').href = appSettings.telegramLink;
        
        // VIP Payment Numbers
        if (appSettings.vipBkash) document.getElementById('bkash-payment-number').textContent = appSettings.vipBkash;
        if (appSettings.vipNagad) document.getElementById('nagad-payment-number').textContent = appSettings.vipNagad;
        
        // Withdrawal Info
        const minWithdraw = appSettings.minWithdraw || 0;
        const maxWithdraw = appSettings.maxWithdraw || 5000;
        document.getElementById('bkash-min-max-info').textContent = `Minimum: ‡ß≥${minWithdraw}, Maximum: ‡ß≥${maxWithdraw}`;
        document.getElementById('nagad-min-max-info').textContent = `Minimum: ‡ß≥${minWithdraw}, Maximum: ‡ß≥${maxWithdraw}`;

        // Exchange Info
        const exchangeRate = appSettings.exchangeRate || 0;
        const minExchange = appSettings.minExchange || 0;
        document.getElementById('exchange-rate-info').textContent = `1000 Coins = ‡ß≥${exchangeRate}`;
        document.getElementById('min-exchange-info').textContent = `Enter coins to exchange (min: ${minExchange})`;
    }

    async function loadAllVipPlans() {
        const plansRef = db.ref('vipPlans');
        const snapshot = await plansRef.once('value');
        const plansContainer = document.getElementById('vip-plans-container-dynamic');
        plansContainer.innerHTML = '';
        if (snapshot.exists()) {
            vipPlans = snapshot.val();
            Object.keys(vipPlans).forEach(planId => {
                const plan = vipPlans[planId];
                plan.id = planId; // Store planId inside the plan object
                const card = document.createElement('div');
                card.className = 'vip-plan-card';
                card.dataset.planName = plan.name;
                card.innerHTML = `
                    <h4>${plan.name}</h4>
                    <p class="price">‡ß≥ ${plan.price}</p>
                    <div class="vip-plan-details">
                        <p><span>Daily Income:</span> <span>‡ß≥ ${plan.dailyIncome}</span></p>
                        <p><span>Daily Tasks:</span> <span>${plan.dailyTasks || 1}</span></p>
                        <p><span>Validity:</span> <span>${plan.validity} Days</span></p>
                        <p><span>Total Return:</span> <span>‡ß≥ ${plan.totalReturn}</span></p>
                    </div>
                    <div class="plan-action-container">
                        <button class="btn btn-buy-vip" onclick="buyVipPlan(${plan.price}, '${plan.name}')">Buy Now</button>
                        <div class="plan-status-display hidden"></div>
                    </div>
                `;
                plansContainer.appendChild(card);
            });
        } else {
            plansContainer.innerHTML = '<p style="text-align:center; color: #8b949e;">No VIP plans available right now.</p>';
        }
    }
    
    async function initializeApp() {
        await loadAppSettings();
        await loadAllVipPlans();
        const user = auth.currentUser;
        if(user){
            loadUserData(user);
            listenForPendingWithdrawals(user);
        }
    }
    // --- END: NEW - Load Settings and Plans from Admin ---


    auth.onAuthStateChanged(user => {
        if (user){ 
            authSection.classList.add('hidden'); 
            userPanelWrapper.classList.remove('hidden'); 
            initializeApp();
        } else { 
            authSection.classList.remove('hidden'); 
            userPanelWrapper.classList.add('hidden');
        }
    }); 

    function loadUserData(user){ 
        db.ref('users/' + user.uid).on('value', snapshot => { 
            const data = snapshot.val();
            if (data) { 
                currentUserData = data;
                const name = data.name || 'User';
                const balance = data.balance || 0;
                const coins = data.coins || 0;
                const totalIncome = data.totalIncome || 0; 
                const plan = data.activePlan || 'Free User';
                
                document.getElementById('user-name-display').innerText = `Hi, ${name}`; 
                document.getElementById('user-balance').innerText = balance.toFixed(0);
                document.getElementById('home-coin-balance').innerText = coins;
                document.getElementById('spin-coin-display').innerText = coins;
                document.getElementById('math-coin-display').innerText = coins;
                document.getElementById('ads-coin-display').innerText = coins; 
                document.getElementById('quiz-coin-display').innerText = coins; 
                document.getElementById('bangla-quiz-coin-display').innerText = coins;
                document.getElementById('scratch-coin-display').innerText = coins;

                document.getElementById('wallet-balance').innerText = balance.toFixed(2);
                document.getElementById('bkash-withdrawable-balance').innerText = balance.toFixed(2);
                document.getElementById('nagad-withdrawable-balance').innerText = balance.toFixed(2);
                loadVipTaskPageContent(user, data); 
                
                const profilePic = data.profilePictureUrl || `https://i.pravatar.cc/150?u=${user.uid}`;
                document.getElementById('me-page-avatar').src = profilePic;
                document.getElementById('header-user-avatar').src = profilePic;

                document.getElementById('me-page-username').innerText = name;
                document.getElementById('me-total-tk').innerText = balance.toFixed(0);
                document.getElementById('me-plan-name').innerText = plan;
                document.getElementById('me-user-uid').innerText = generate4DigitId(user.uid);
                document.getElementById('me-user-gmail').innerText = user.email || 'N/A';
                document.getElementById('me-total-income').innerText = totalIncome.toFixed(0);

                checkPlanExpiration(user, data);
                updateVipPlanCards(data);
            } 
        }); 
    }

    function listenForPendingWithdrawals(user) {
        const query = db.ref('withdrawals').orderByChild('userId').equalTo(user.uid);
        query.on('value', snapshot => {
            let hasPending = false;
            if (snapshot.exists()) {
                snapshot.forEach(childSnapshot => {
                    if (childSnapshot.val().status === 'pending') {
                        hasPending = true;
                    }
                });
            }
            updateWithdrawalUI(hasPending);
            loadWithdrawalHistory(user);
        });
    }

    function updateWithdrawalUI(hasPending) {
        const notice = document.getElementById('pending-withdraw-notice');
        const content = document.getElementById('withdraw-content');
        if (hasPending) {
            notice.classList.remove('hidden');
            content.classList.add('hidden');
        } else {
            notice.classList.add('hidden');
            content.classList.remove('hidden');
        }
    }
    
    // --- Game Ad Logic ---
    async function showVipStyleAdAndReward(rewardAmount, rewardMessage, onCompleteCallback) {
        const adModal = document.getElementById('ad-modal');
        const adModalContent = document.getElementById('ad-modal-content');
        if (!adModal || !adModalContent) {
            // Fallback in case modal is not found
            updateCoinBalance(rewardAmount);
            alert(rewardMessage);
            onCompleteCallback();
            return;
        }

        // Pick a random ad
        const adIndex = Math.floor(Math.random() * vipAdScripts.length);
        const adData = vipAdScripts[adIndex];
        
        // Check for URL-based ad, which should open in a new tab
        if (adData.startsWith('http')) {
            window.open(adData, '_blank');
            // Since we can't wait for the user, grant reward immediately
            updateCoinBalance(rewardAmount);
            alert(rewardMessage);
            onCompleteCallback();
            return;
        }

        adModalContent.innerHTML = `
            <div id="ad-container-generic" style="min-height: 250px; display: flex; justify-content: center; align-items: center; flex-direction: column;">
                ${adData}
            </div>
            <p style="font-size:12px; color: #8b949e; margin-top: 15px;">Please watch the ad. Your reward will be granted automatically in 10 seconds.</p>
        `;
        const adContainer = document.getElementById('ad-container-generic');

        // Re-execute script tags for script-based ads
        if (adContainer) {
            Array.from(adContainer.querySelectorAll("script")).forEach(oldScript => {
                const newScript = document.createElement("script");
                Array.from(oldScript.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value));
                if (oldScript.src) {
                    newScript.src = oldScript.src;
                } else {
                    newScript.text = oldScript.text;
                }
                oldScript.parentNode.replaceChild(newScript, oldScript);
            });
        }
        
        adModal.classList.remove('hidden');

        setTimeout(() => {
            // Ensure the modal is still open before acting
            if (!adModal.classList.contains('hidden')) {
                adModal.classList.add('hidden');
                updateCoinBalance(rewardAmount);
                alert(rewardMessage);
                onCompleteCallback();
            }
        }, 15000); // 10 seconds
    }


    // --- MODIFIED VIP TASK LOGIC ---
    async function loadVipTaskPageContent(user, userData) {
        const planName = userData.activePlan;
        const planStatus = userData.planStatus;

        if (planName !== 'Free User' && planStatus === 'active') {
            vipTaskActivePlanDiv.classList.remove('hidden');
            vipTaskNoPlanDiv.classList.add('hidden');
            activePlanNameSpan.innerText = `${planName} Plan`;
            
            let planDetails = null;
            for (const planId in vipPlans) {
                if (vipPlans[planId].name === planName) {
                    planDetails = vipPlans[planId];
                    break;
                }
            }

            if (!planDetails || !planDetails.dailyTasks || planDetails.dailyTasks <= 0) {
                 vipTaskContainer.innerHTML = '<p>No tasks configured for this plan.</p>';
                 return;
            }

            const dailyTasks = planDetails.dailyTasks;
            // FIX: Ensure dailyIncome is a number before division to prevent NaN
            const dailyIncome = typeof planDetails.dailyIncome === 'number' ? planDetails.dailyIncome : 0;
            const rewardPerTask = dailyIncome / dailyTasks;

            vipTaskContainer.innerHTML = '';
            const today = new Date().toISOString().split('T')[0];
            const userTaskRef = db.ref(`users/${user.uid}/dailyVipTasks`);
            const snapshot = await userTaskRef.once('value');
            let userTaskData = snapshot.val();

            if (!userTaskData || userTaskData.lastCompletionDate !== today) {
                userTaskData = { completed: {}, lastCompletionDate: today };
                await userTaskRef.set(userTaskData); // Reset daily tasks
            }
            
            const completedTasks = userTaskData.completed || {};

            for (let i = 1; i <= dailyTasks; i++) {
                const taskItem = document.createElement('div');
                taskItem.className = 'vip-task-item';
                
                const taskText = document.createElement('p');
                taskText.textContent = `Watch Ad ${i}`;

                const claimButton = document.createElement('button');
                claimButton.className = 'btn-claim-vip-task';
                
                // FIX: Check if reward is valid before creating the button logic
                if (isNaN(rewardPerTask) || !isFinite(rewardPerTask)) {
                    claimButton.disabled = true;
                    claimButton.textContent = 'Task Error';
                } else if (completedTasks[i]) {
                    claimButton.disabled = true;
                    claimButton.textContent = 'Completed';
                } else {
                    claimButton.textContent = `Claim ‡ß≥${rewardPerTask.toFixed(2)}`;
                    claimButton.onclick = () => completeVipTask(i, rewardPerTask, planName);
                }
                
                taskItem.appendChild(taskText);
                taskItem.appendChild(claimButton);
                vipTaskContainer.appendChild(taskItem);
            }

        } else {
            vipTaskActivePlanDiv.classList.add('hidden');
            vipTaskNoPlanDiv.classList.remove('hidden');
        }
    }
    
    async function completeVipTask(taskNumber, rewardPerTask, planName) {
        const user = auth.currentUser; if (!user) return;
        
        const taskItem = document.querySelector(`#vip-task-container > .vip-task-item:nth-child(${taskNumber})`);
        const button = taskItem ? taskItem.querySelector('.btn-claim-vip-task') : null;
        if (button) {
            button.disabled = true;
            button.innerText = 'Processing...';
        }
        
        let adCompleted = false;
        const adIndex = (taskNumber - 1) % vipAdScripts.length;
        const adData = vipAdScripts[adIndex];
        const adModal = document.getElementById('ad-modal');
        const adModalContent = document.getElementById('ad-modal-content');

        const grantReward = async () => {
             if (adCompleted) return;
             adCompleted = true;

            const userRef = db.ref('users/' + user.uid);
            try {
                await userRef.transaction(currentData => {
                    if (currentData) {
                        const today = new Date().toISOString().split('T')[0];
                        
                        if (!currentData.dailyVipTasks || currentData.dailyVipTasks.lastCompletionDate !== today) {
                             currentData.dailyVipTasks = { completed: {}, lastCompletionDate: today };
                        }
                        if (currentData.dailyVipTasks.completed && currentData.dailyVipTasks.completed[taskNumber]) { return; } 
                        
                        currentData.balance = (currentData.balance || 0) + rewardPerTask;
                        currentData.totalIncome = (currentData.totalIncome || 0) + rewardPerTask;
                        if(!currentData.dailyVipTasks.completed) currentData.dailyVipTasks.completed = {};
                        currentData.dailyVipTasks.completed[taskNumber] = true;
                    }
                    return currentData;
                });
                alert(`Task ${taskNumber} complete! ‡ß≥${rewardPerTask.toFixed(2)} has been added.`);
            } catch (error) {
                alert("An error occurred. " + error.message);
                if(button) { button.disabled = false; button.innerText = `Claim ‡ß≥${rewardPerTask.toFixed(2)}`; }
            } finally {
                adModal.classList.add('hidden'); // Close modal after reward
            }
        };

        // Show ad in modal
        adModalContent.innerHTML = `
            <div id="ad-container-vip" style="display: flex; justify-content: center; align-items: center; flex-direction: column;"></div>
            <p style="font-size:12px; color: #8b949e; margin-top: 15px;">Please watch the ad. Your reward will be granted automatically.</p>
        `;
        const adContainer = document.getElementById('ad-container-vip');
        adContainer.innerHTML = adData;
        
        Array.from(adContainer.querySelectorAll("script")).forEach(oldScript => {
            const newScript = document.createElement("script");
            Array.from(oldScript.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value));
            newScript.text = oldScript.text;
            if (oldScript.src) newScript.src = oldScript.src;
            oldScript.parentNode.replaceChild(newScript, oldScript);
        });

        adModal.classList.remove('hidden');
        setTimeout(grantReward, 20000); // Grant reward after 20 seconds
    }
    // --- END: MODIFIED VIP TASK LOGIC ---


    const pageMap = { 
        'nav-home': 'home-page', 
        'nav-vip': 'vip-page', 
        'nav-task': 'vip-task-page', 
        'nav-wallet': 'wallet-page', 
        'nav-me': 'me-page'
    };
    
    function switchPage(pageId) {
        pages.forEach(p => p.classList.add('hidden'));
        const targetPage = document.getElementById(pageId);
        if(targetPage) targetPage.classList.remove('hidden');

        if (['spin-wheel-page', 'solve-math-page', 'watch-ads-page', 'quiz-page', 'bangla-quiz-page', 'scratch-card-page'].includes(pageId)) {
            bottomNav.classList.add('hidden');
        } else {
            bottomNav.classList.remove('hidden');
        }
        
        navItems.forEach(item => {
            const isNavItemForPage = pageMap[item.id] === pageId;
            item.classList.toggle('active', isNavItemForPage);
        });
        
        if (pageId === 'home-page') {
            document.getElementById('nav-home').classList.add('active');
        }
    }

    navItems.forEach(item => item.addEventListener('click', () => switchPage(pageMap[item.id])));
    
    function showErrorMessage(element, message) { element.textContent = message; }
    function hideErrorMessage(element) { element.textContent = ''; }

    function generate4DigitId(uid) { let hash = 0; if (!uid) return 1000; for (let i = 0; i < uid.length; i++) { hash = (hash << 5) - hash + uid.charCodeAt(i); hash |= 0; } return 1000 + Math.abs(hash % 9000); }
    
    document.getElementById('register-btn').addEventListener('click', () => { 
        const email = document.getElementById('register-email').value; 
        const password = document.getElementById('register-password').value; 
        const confirmPassword = document.getElementById('register-confirm-password').value; 
        const errorElement = document.getElementById('register-error-message');
        if (!email || !password || !confirmPassword) { 
            showErrorMessage(errorElement, "Please fill in all fields."); return; 
        } 
        if (password !== confirmPassword) { 
            showErrorMessage(errorElement, "Passwords do not match."); return; 
        } 
        hideErrorMessage(errorElement); 
        auth.createUserWithEmailAndPassword(email, password).then(userCredential => { 
            const user = userCredential.user; 
            const randomAvatarUrl = `https://i.pravatar.cc/150?u=${user.uid}`;

            db.ref('users/' + user.uid).set({ 
                email: user.email, 
                balance: 0, 
                coins: 0, 
                totalIncome: 0, 
                name: email.split('@')[0], 
                activePlan: 'Free User', 
                planStatus: 'none', 
                pendingPlanName: null, 
                planExpiryDate: null, 
                profilePictureUrl: randomAvatarUrl, 
                createdAt: firebase.database.ServerValue.TIMESTAMP 
            }); 
        }).catch(error => { 
            let message = "An unexpected error occurred."; 
            if (error.code === 'auth/email-already-in-use') { message = "This email is already registered."; } 
            else if (error.code === 'auth/weak-password') { message = "Password must be at least 6 characters long."; } 
            else if (error.code === 'auth/invalid-email') { message = "Please enter a valid email address."; } 
            showErrorMessage(errorElement, message); 
        }); 
    });

    document.getElementById('login-btn').addEventListener('click', () => { 
        const email = document.getElementById('login-email').value; 
        const password = document.getElementById('login-password').value; 
        const errorElement = document.getElementById('login-error-message');
        if (!email || !password) { 
            showErrorMessage(errorElement, "Please enter email and password."); return; 
        } 
        hideErrorMessage(errorElement); 
        auth.signInWithEmailAndPassword(email, password).catch(error => { 
            let message = "An error occurred."; 
            if (error.code === 'auth/invalid-credential' || error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password') { 
                message = "Incorrect email or password."; 
            } else if (error.code === 'auth/invalid-email') { 
                message = "Please enter a valid email address."; 
            } 
            showErrorMessage(errorElement, message); 
        }); 
    });


    function checkPlanExpiration(user, userData) {
        if (userData.planStatus === 'active' && userData.planExpiryDate) {
            const now = Date.now();
            if (now > userData.planExpiryDate) {
                alert("Your plan has expired.");
                const updates = { 
                    activePlan: 'Free User', 
                    planStatus: 'none', 
                    planExpiryDate: null, 
                    planPurchaseDate: null, 
                    pendingPlanName: null, 
                    dailyVipTasks: null 
                };
                db.ref('users/' + user.uid).update(updates);
            }
        }
    }

    function startCountdown(expiryTimestamp) {
        const countdownElement = document.getElementById('plan-countdown');
        if (!countdownElement) return;
        if(countdownInterval) clearInterval(countdownInterval);

        countdownInterval = setInterval(() => {
            const now = new Date().getTime();
            const distance = expiryTimestamp - now;

            if (distance < 0) {
                clearInterval(countdownInterval);
                countdownElement.innerHTML = "Plan Expired";
                return;
            }

            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            countdownElement.innerHTML = `${days}d ${hours}h ${minutes}m ${seconds}s remaining`;
        }, 1000);
    }
    
    function updateVipPlanCards(userData) {
        if (countdownInterval) clearInterval(countdownInterval);
        const planCards = document.querySelectorAll('.vip-plan-card');
        const noticeDiv = document.getElementById('vip-page-notice');
        const userStatus = userData.planStatus || 'none';
        const activePlanName = userData.activePlan;
        const pendingPlanName = userData.pendingPlanName;

        if (userStatus === 'active') {
            const expiryDate = new Date(userData.planExpiryDate).toLocaleString();
            noticeDiv.innerHTML = `Your ${activePlanName} plan is active until ${expiryDate}.
                                 <p id="plan-countdown" style="font-size: 16px; font-weight: bold; margin-top: 8px; color: #fff;"></p>`;
            noticeDiv.classList.remove('hidden');
            startCountdown(userData.planExpiryDate);

        } else if (userStatus === 'pending') {
            noticeDiv.innerText = `Your request for the ${pendingPlanName} plan is pending approval.`;
            noticeDiv.classList.remove('hidden');
        } else {
            noticeDiv.classList.add('hidden');
        }

        planCards.forEach(card => {
            const cardPlanName = card.dataset.planName;
            const buyButton = card.querySelector('.btn-buy-vip');
            const statusDisplay = card.querySelector('.plan-status-display');
            
            buyButton.classList.remove('hidden');
            buyButton.disabled = false;
            statusDisplay.classList.add('hidden');
            statusDisplay.textContent = '';
            
            const existingNotice = card.querySelector('.plan-active-notice');
            if (existingNotice) existingNotice.remove();


            if (userStatus === 'pending') {
                buyButton.disabled = true; // Disable all buy buttons if a request is pending
                if (cardPlanName === pendingPlanName) {
                    buyButton.classList.add('hidden');
                    statusDisplay.textContent = 'Pending Approval';
                    statusDisplay.className = 'plan-status-display pending';
                    statusDisplay.classList.remove('hidden');
                }
            } else if (userStatus === 'active') {
                buyButton.disabled = true; // Disable all buy buttons if a plan is active
                 if (cardPlanName === activePlanName) {
                    buyButton.classList.add('hidden');
                    statusDisplay.textContent = 'Plan Active';
                    statusDisplay.className = 'plan-status-display active';
                    statusDisplay.classList.remove('hidden');
                }
            }
        });
        
        // Add a general notice if any plan is active or pending
        if(userStatus === 'active' || userStatus === 'pending'){
            planCards.forEach(card => {
                 const cardPlanName = card.dataset.planName;
                 if(cardPlanName !== activePlanName && cardPlanName !== pendingPlanName){
                     const container = card.querySelector('.plan-action-container');
                     const existingNotice = container.querySelector('.plan-active-notice');
                     if(!existingNotice){
                        const activeNotice = document.createElement('p');
                        activeNotice.className = 'plan-active-notice';
                        activeNotice.innerText = 'You already have a plan.';
                        container.appendChild(activeNotice);
                     }
                 }
            });
        }
    }

    
    function fallbackCopy(text) { const textArea = document.createElement("textarea"); textArea.value = text; textArea.style.position = "fixed"; textArea.style.top = "-9999px"; document.body.appendChild(textArea); textArea.focus(); textArea.select(); try { document.execCommand('copy'); return true; } catch (err) { return false; } finally { document.body.removeChild(textArea); } }
    function copyToClipboard(text, buttonElement) { if (navigator.clipboard && window.isSecureContext) { navigator.clipboard.writeText(text).then(() => { showCopySuccess(buttonElement); }).catch(() => { if(fallbackCopy(text)) showCopySuccess(buttonElement); else alert('Failed to copy.'); }); } else { if(fallbackCopy(text)) showCopySuccess(buttonElement); else alert('Failed to copy.'); } }
    function showCopySuccess(buttonElement) { const originalText = buttonElement.innerText; buttonElement.innerText = 'Copied!'; buttonElement.disabled = true; setTimeout(() => { buttonElement.innerText = originalText; buttonElement.disabled = false; }, 2000); }

    document.getElementById('me-logout-btn').addEventListener('click', () => auth.signOut());
    document.getElementById('withdrawal-history-link').addEventListener('click', () => switchPage('history-page'));
    document.getElementById('back-to-wallet-btn').addEventListener('click', () => switchPage('wallet-page'));
    document.getElementById('buy-plan-now-btn').addEventListener('click', () => switchPage('vip-page'));
    document.getElementById('bkash-all-btn').addEventListener('click', () => { document.getElementById('bkash-amount').value = Math.floor(currentUserData.balance || 0); });
    document.getElementById('nagad-all-btn').addEventListener('click', () => { document.getElementById('nagad-amount').value = Math.floor(currentUserData.balance || 0); });
    document.getElementById('bkash-withdraw-btn').addEventListener('click', (e) => { processWithdrawalRequest('bKash', document.getElementById('bkash-number').value, document.getElementById('bkash-amount').value, e.target); });
    document.getElementById('nagad-withdraw-btn').addEventListener('click', (e) => { processWithdrawalRequest('Nagad', document.getElementById('nagad-number').value, document.getElementById('nagad-amount').value, e.target); });
    document.getElementById('copy-bkash-btn').addEventListener('click', (e) => { copyToClipboard(document.getElementById('bkash-payment-number').innerText, e.target); });
    document.getElementById('copy-nagad-btn').addEventListener('click', (e) => { copyToClipboard(document.getElementById('nagad-payment-number').innerText, e.target); });
    document.getElementById('close-payment-modal-btn').addEventListener('click', () => { document.getElementById('payment-modal').classList.add('hidden'); });
    const selectBkashBtn = document.getElementById('select-bkash-btn'); const selectNagadBtn = document.getElementById('select-nagad-btn'); const bkashForm = document.getElementById('bkash-withdraw-form'); const nagadForm = document.getElementById('nagad-withdraw-form');
    selectBkashBtn.addEventListener('click', () => { selectBkashBtn.classList.add('selected'); selectNagadBtn.classList.remove('selected'); bkashForm.classList.remove('hidden'); nagadForm.classList.add('hidden'); });
    selectNagadBtn.addEventListener('click', () => { selectNagadBtn.classList.add('selected'); selectBkashBtn.classList.remove('selected'); nagadForm.classList.remove('hidden'); bkashForm.classList.add('hidden'); });
    const vipBkashRadio = document.getElementById('vip-bkash'); const vipNagadRadio = document.getElementById('vip-nagad'); const vipBkashNumberDisplay = document.getElementById('vip-bkash-number-display'); const vipNagadNumberDisplay = document.getElementById('vip-nagad-number-display');
    vipBkashRadio.addEventListener('change', () => { if (vipBkashRadio.checked) { vipBkashNumberDisplay.classList.remove('hidden'); vipNagadNumberDisplay.classList.add('hidden'); } });
    vipNagadRadio.addEventListener('change', () => { if (vipNagadRadio.checked) { vipNagadNumberDisplay.classList.remove('hidden'); vipBkashNumberDisplay.classList.add('hidden'); } });
    const editProfileBtn = document.getElementById('me-edit-profile-btn');
    const usernameModal = document.getElementById('username-modal'); 
    const modalUsernameInput = document.getElementById('modal-username-input'); 
    const modalSaveUsernameBtn = document.getElementById('modal-save-username-btn'); 
    const modalCancelUsernameBtn = document.getElementById('modal-cancel-username-btn');
    editProfileBtn.addEventListener('click', () => { 
        modalUsernameInput.value = currentUserData.name || ''; 
        usernameModal.classList.remove('hidden'); 
    });
    modalCancelUsernameBtn.addEventListener('click', () => { usernameModal.classList.add('hidden'); });
    modalSaveUsernameBtn.addEventListener('click', () => { const newName = modalUsernameInput.value.trim(); const user = auth.currentUser; if (newName && newName.length > 2 && user) { modalSaveUsernameBtn.disabled = true; modalSaveUsernameBtn.innerText = "Saving..."; db.ref('users/' + user.uid).update({ name: newName }).then(() => { usernameModal.classList.add('hidden'); alert('Name changed successfully!'); }).catch(error => alert("Error: " + error.message)).finally(() => { modalSaveUsernameBtn.disabled = false; modalSaveUsernameBtn.innerText = "Save"; }); } else { alert("Please enter a valid name (at least 3 characters)."); } });
    document.getElementById('verify-payment-btn').addEventListener('click', (e) => {
        const verifyBtn = e.target; verifyBtn.disabled = true; verifyBtn.innerText = 'Verifying...';
        const transactionId = document.getElementById('transaction-id-input').value.trim();
        const user = auth.currentUser; if (!user || !transactionId) { alert("Please enter a valid Transaction ID."); verifyBtn.disabled = false; verifyBtn.innerText = 'Verify Payment'; return; }
        const paymentMethod = document.querySelector('input[name="vip-payment-method"]:checked').value;
        const purchaseRequest = { userId: user.uid, userName: currentUserData.name, userEmail: user.email, planName: selectedPlanName, planPrice: selectedPlanPrice, paymentMethod: paymentMethod, transactionId: transactionId, status: 'pending', requestDate: firebase.database.ServerValue.TIMESTAMP };
        const newPurchaseKey = db.ref().child('purchases').push().key;
        const updates = {}; updates['/purchases/' + newPurchaseKey] = purchaseRequest; updates['/users/' + user.uid + '/planStatus'] = 'pending'; updates['/users/' + user.uid + '/pendingPlanName'] = selectedPlanName;
        db.ref().update(updates).then(() => { alert('Your request has been received.'); document.getElementById('payment-modal').classList.add('hidden'); document.getElementById('transaction-id-input').value = ''; }).catch(error => { alert('An error occurred: ' + error.message); }).finally(() => { verifyBtn.disabled = false; verifyBtn.innerText = 'Verify Payment'; });
    });
    function buyVipPlan(price, planName) {
        if (!auth.currentUser) { alert("Please log in to purchase a plan."); return; }
        if (currentUserData.planStatus === 'pending' || currentUserData.planStatus === 'active') { 
            alert("You already have an active or pending plan. You cannot buy another one now."); 
            return; 
        }
        selectedPlanPrice = price; selectedPlanName = planName;
        document.getElementById('plan-price-display').innerText = `‡ß≥${price}`;
        vipBkashRadio.checked = true; vipBkashNumberDisplay.classList.remove('hidden'); vipNagadNumberDisplay.classList.add('hidden');
        document.getElementById('transaction-id-input').value = ''; document.getElementById('payment-modal').classList.remove('hidden');
    }
    function processWithdrawalRequest(method, number, amount, buttonElement) {
        const user = auth.currentUser;
        if (!user || !number || !amount) {
            alert("Please enter a valid number and amount.");
            return;
        }
        const numericAmount = parseFloat(amount);
        const minWithdraw = appSettings.minWithdraw || 0;
        const maxWithdraw = appSettings.maxWithdraw || 5000;

        if (isNaN(numericAmount) || numericAmount <= 0) { alert("Please enter a valid amount."); return; }
        if (numericAmount < minWithdraw) { alert(`Minimum withdrawal amount is ‡ß≥${minWithdraw}.`); return; }
        if (numericAmount > maxWithdraw) { alert(`Maximum withdrawal amount is ‡ß≥${maxWithdraw}.`); return; }
        if (numericAmount > currentUserData.balance) { alert("Insufficient balance."); return; }
        buttonElement.disabled = true; buttonElement.innerText = 'Processing...';
        const newBalance = currentUserData.balance - numericAmount;
        const withdrawalData = { userId: user.uid, userName: currentUserData.name, method: method, number: number, amount: numericAmount, status: 'pending', requestDate: firebase.database.ServerValue.TIMESTAMP };
        const newWithdrawalKey = db.ref().child('withdrawals').push().key;
        const updates = {};
        updates['/users/' + user.uid + '/balance'] = newBalance;
        updates['/withdrawals/' + newWithdrawalKey] = withdrawalData;
        db.ref().update(updates).then(() => {
            alert(`Withdrawal request for ‡ß≥${numericAmount} submitted.`);
            document.getElementById('bkash-number').value = '';
            document.getElementById('bkash-amount').value = '';
            document.getElementById('nagad-number').value = '';
            document.getElementById('nagad-amount').value = '';
        }).catch(error => {
            alert("Error: " + error.message);
            db.ref('users/' + user.uid).update({ balance: currentUserData.balance });
        }).finally(() => {
            buttonElement.disabled = false;
            buttonElement.innerText = 'Withdraw';
        });
    }
    function loadWithdrawalHistory(user) {
        const historyList = document.getElementById('history-list');
        const query = db.ref('withdrawals').orderByChild('userId').equalTo(user.uid);
        query.on('value', snapshot => {
            historyList.innerHTML = '';
            if(snapshot.exists()){
                const allHistory = []; snapshot.forEach(childSnapshot => { allHistory.push(childSnapshot.val()); });
                allHistory.sort((a, b) => b.requestDate - a.requestDate);
                allHistory.forEach(history => {
                    const date = new Date(history.requestDate).toLocaleString('en-US', { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
                    let statusClass = 'status-pending'; let noticeHTML = '';
                    if (history.status === 'completed') { statusClass = 'status-completed';
                    } else if (history.status === 'rejected') { statusClass = 'status-rejected'; noticeHTML = `<div class="notice-message rejected-notice">Your request was rejected! Please contact our team.</div>`;
                    } else { noticeHTML = `<div class="notice-message pending-notice">You will receive your payment within 12 to 24 hours.</div>`; }
                    const item = document.createElement('div');
                    item.className = 'history-item';
                    item.innerHTML = `<div class="history-main-info"><div class="history-details"><p style="font-size: 16px; font-weight: bold; color: white;">Amount: ${history.amount}</p><p style="color: #c9d1d9;">Number: ${history.number} (${history.method})</p><p style="font-size: 12px; color: #8b949e;">${date}</p></div><span class="history-status ${statusClass}">${history.status}</span></div>${noticeHTML}`;
                    historyList.appendChild(item);
                });
            } else { historyList.innerHTML = '<p style="text-align: center; color: #8b949e;">No history found.</p>'; }
        });
    }

    // --- START: Coin Exchange Modal Logic ---
    const exchangeModal = document.getElementById('exchange-modal');
    const exchangeCoinInput = document.getElementById('exchange-coin-input');
    const exchangeResult = document.getElementById('exchange-result');
    
    document.getElementById('exchange-coins-btn').addEventListener('click', () => {
        exchangeCoinInput.value = '';
        const exchangeRate = appSettings.exchangeRate || 0;
        exchangeResult.textContent = `You will get: ‡ß≥0.00`;
        exchangeModal.classList.remove('hidden');
    });

    exchangeCoinInput.addEventListener('input', () => {
        const coins = parseInt(exchangeCoinInput.value) || 0;
        const exchangeRate = appSettings.exchangeRate || 0;
        const taka = (coins / 1000) * exchangeRate;
        exchangeResult.textContent = `You will get: ‡ß≥${taka.toFixed(2)}`;
    });

    document.getElementById('cancel-exchange-btn').addEventListener('click', () => {
        exchangeModal.classList.add('hidden');
    });

    document.getElementById('confirm-exchange-btn').addEventListener('click', () => {
        const user = auth.currentUser;
        const coinsToExchange = parseInt(exchangeCoinInput.value);
        const minExchange = appSettings.minExchange || 0;
        const exchangeRate = appSettings.exchangeRate || 0;

        if (!user) return;
        if (isNaN(coinsToExchange) || coinsToExchange < minExchange) {
            alert(`Minimum exchange amount is ${minExchange} coins.`);
            return;
        }
        if (coinsToExchange > (currentUserData.coins || 0)) {
            alert("You do not have enough coins.");
            return;
        }

        const takaToReceive = (coinsToExchange / 1000) * exchangeRate;
        const userRef = db.ref('users/' + user.uid);
        
        userRef.transaction(currentData => {
            if (currentData && currentData.coins >= coinsToExchange) {
                currentData.coins -= coinsToExchange;
                currentData.balance = (currentData.balance || 0) + takaToReceive;
                currentData.totalIncome = (currentData.totalIncome || 0) + takaToReceive; 
            }
            return currentData;
        }).then(() => {
            alert("Exchange successful!");
            exchangeModal.classList.add('hidden');
        }).catch(error => {
            alert("An error occurred: " + error.message);
        });
    });

    // --- START: Spin Wheel Logic ---
    const spinBtn = document.getElementById('spin-btn');
    const canvas = document.getElementById('spin-canvas');
    const spinCountDisplay = document.getElementById('spin-count-display');
    const ctx = canvas.getContext('2d');
    const segments = [
        { color: '#4A90E2', label: '5', value: 5 }, { color: '#50E3C2', label: '50', value: 50 },
        { color: '#B8E986', label: '0', value: 0 }, { color: '#F8E71C', label: '10', value: 10 },
        { color: '#F5A623', label: '5', value: 5 }, { color: '#D0021B', label: '20', value: 20 },
        { color: '#BD10E0', label: '15', value: 15 }, { color: '#E9792E', label: '0', value: 0 }
    ];
    const seg_count = segments.length;
    const arc = Math.PI * 2 / seg_count;
    let isSpinning = false;
    let rotation = 0;

    function drawWheel() {
        const canvasSize = 284; const radius = canvasSize / 2;
        ctx.save();
        ctx.clearRect(0, 0, canvasSize, canvasSize);
        ctx.translate(radius, radius); ctx.rotate(rotation * Math.PI / 180); ctx.translate(-radius, -radius);
        segments.forEach((segment, i) => {
            const angle = i * arc;
            ctx.fillStyle = segment.color;
            ctx.beginPath(); ctx.arc(radius, radius, radius, angle, angle + arc, false); ctx.lineTo(radius, radius); ctx.fill();
            ctx.save();
            ctx.fillStyle = "white"; ctx.font = 'bold 20px Roboto';
            ctx.translate(radius + Math.cos(angle + arc / 2) * (radius * 0.7), radius + Math.sin(angle + arc / 2) * (radius * 0.7));
            ctx.rotate(angle + arc / 2 + Math.PI / 2);
            const text = segment.label;
            ctx.fillText(text, -ctx.measureText(text).width / 2, 0);
            ctx.restore();
        });
        ctx.restore();
    }
    
    async function initializeSpinPage() {
        const user = auth.currentUser; if (!user) return;
        const dailySpinLimit = appSettings.spinLimit || 0;
        const today = new Date().toISOString().split('T')[0];
        const spinRef = db.ref(`users/${user.uid}/dailySpins`);
        const snapshot = await spinRef.once('value');
        let spinData = snapshot.val();
        if (!spinData || spinData.lastSpinDate !== today) {
            spinData = { count: 0, lastSpinDate: today };
            await spinRef.set(spinData);
        }
        const spinsRemaining = dailySpinLimit - spinData.count;
        spinCountDisplay.textContent = `Today's Spins Remaining: ${spinsRemaining}/${dailySpinLimit}`;
        spinBtn.disabled = isSpinning || spinsRemaining <= 0;
        spinBtn.textContent = (spinsRemaining <= 0) ? "NO SPINS" : "SPIN";
    }

    function spin() {
        if (isSpinning) return;
        isSpinning = true; spinBtn.disabled = true;
        const randomExtraRotation = Math.random() * 360;
        const totalRotation = 360 * 8 + randomExtraRotation;
        let start = null;
        function animate(timestamp) {
            if (!start) start = timestamp;
            const progress = timestamp - start;
            const duration = 5000;
            const easeOutProgress = 1 - Math.pow(1 - (progress / duration), 3);
            const currentRotation = easeOutProgress * totalRotation;
            rotation = currentRotation;
            drawWheel();
            if (progress < duration) { requestAnimationFrame(animate); } else { rotation = totalRotation; drawWheel(); finishSpin(); }
        }
        requestAnimationFrame(animate);
    }
    
    function finishSpin() {
        const finalAngle = rotation % 360;
        const segmentAngle = 360 / seg_count;
        const pointerAngle = 270;
        const effectiveAngle = (360 - finalAngle + pointerAngle) % 360;
        const winningIndex = Math.floor(effectiveAngle / segmentAngle);
        const prize = segments[winningIndex];

        setTimeout(() => {
            if (prize && prize.value > 0) {
                const onComplete = () => {
                    isSpinning = false;
                    recordSpin();
                };
                showVipStyleAdAndReward(prize.value, `Congratulations! You won ${prize.value} coins.`, onComplete);
            } else {
                alert("Better luck next time!");
                isSpinning = false;
                recordSpin();
            }
        }, 200);
    }
    
    function recordSpin() {
        const user = auth.currentUser; if (!user) return;
        const spinRef = db.ref(`users/${user.uid}/dailySpins`);
        spinRef.transaction(currentData => {
            const today = new Date().toISOString().split('T')[0];
            if (currentData && currentData.lastSpinDate === today) { currentData.count++; } else { currentData = { count: 1, lastSpinDate: today };}
            return currentData;
        }).then(() => { initializeSpinPage(); });
    }

    function updateCoinBalance(amount) {
        const user = auth.currentUser;
        if (!user) { alert("You must be logged in to claim rewards."); return; }
        const userRef = db.ref('users/' + user.uid);
        userRef.transaction(currentData => {
            if (currentData) { currentData.coins = (currentData.coins || 0) + amount; }
            return currentData;
        });
    }

    function openSpinWheel() {
        const user = auth.currentUser; if(!user) { alert("Please log in to play!"); return; }
        switchPage('spin-wheel-page');
        rotation = 0; drawWheel(); initializeSpinPage();
    }

    spinBtn.addEventListener('click', spin);

    // --- START: Solve Math Logic ---
    const mathProblemText = document.getElementById('math-problem-text');
    const mathOptionsContainer = document.getElementById('math-options-container');
    const mathCountDisplay = document.getElementById('math-count-display');
    let currentMathAnswer = 0;

    function generateNewMathProblem() {
        const num1 = Math.floor(Math.random() * 50) + 1; const num2 = Math.floor(Math.random() * 50) + 1;
        currentMathAnswer = num1 + num2;
        mathProblemText.textContent = `${num1} + ${num2} = ?`;
        const options = new Set();
        options.add(currentMathAnswer);
        while (options.size < 4) {
            const offset = Math.floor(Math.random() * 9) + 2;
            let wrongAnswer = (Math.random() > 0.5) ? currentMathAnswer + offset : currentMathAnswer - offset;
            if (wrongAnswer >= 0 && !options.has(wrongAnswer)) { options.add(wrongAnswer); }
        }
        const shuffledOptions = Array.from(options).sort(() => Math.random() - 0.5);
        mathOptionsContainer.innerHTML = '';
        shuffledOptions.forEach(option => {
            const button = document.createElement('button');
            button.className = 'math-option-btn';
            button.textContent = option;
            button.onclick = (event) => checkMathAnswer(option, event.target);
            mathOptionsContainer.appendChild(button);
        });
    }

    async function initializeMathPage() {
        const user = auth.currentUser; if (!user) return;
        const dailyMathLimit = appSettings.mathLimit || 0;
        const today = new Date().toISOString().split('T')[0];
        const mathRef = db.ref(`users/${user.uid}/dailyMath`);
        const snapshot = await mathRef.once('value');
        let mathData = snapshot.val();
        if (!mathData || mathData.lastSolveDate !== today) {
            mathData = { count: 0, lastSolveDate: today };
            await mathRef.set(mathData);
        }
        const tasksRemaining = dailyMathLimit - mathData.count;
        mathCountDisplay.textContent = `Today's Tasks Remaining: ${tasksRemaining}/${dailyMathLimit}`;
        if (tasksRemaining <= 0) {
            mathOptionsContainer.innerHTML = ''; mathProblemText.textContent = 'No tasks left for today!';
        } else { generateNewMathProblem(); }
    }

    function recordMathSolve() {
        const user = auth.currentUser; if (!user) return;
        const mathRef = db.ref(`users/${user.uid}/dailyMath`);
        mathRef.transaction(currentData => {
            const today = new Date().toISOString().split('T')[0];
            if (currentData && currentData.lastSolveDate === today) { currentData.count++; } else { currentData = { count: 1, lastSolveDate: today }; }
            return currentData;
        }).then(() => { setTimeout(initializeMathPage, 500); });
    }

    function checkMathAnswer(selectedAnswer, buttonElement) {
        document.querySelectorAll('#math-options-container .math-option-btn').forEach(btn => {
            btn.disabled = true;
            if (parseInt(btn.textContent) === currentMathAnswer) {
                btn.classList.add('correct');
            }
        });

        if (selectedAnswer === currentMathAnswer) {
            buttonElement.classList.add('correct');
            const reward = Math.floor(Math.random() * 11) + 5;
            setTimeout(() => {
                const onComplete = () => {
                    recordMathSolve();
                };
                showVipStyleAdAndReward(reward, `Correct! You won ${reward} coins.`, onComplete);
            }, 500);
        } else {
            buttonElement.classList.add('wrong');
            setTimeout(() => {
                alert("Wrong answer. Here is a new problem.");
                initializeMathPage();
            }, 500);
        }
    }


    function openSolveMath() {
        const user = auth.currentUser; if(!user) { alert("Please log in to play!"); return; }
        switchPage('solve-math-page'); initializeMathPage();
    }
    
    // --- START: Watch Ads Logic ---
    const adTaskList = document.getElementById('ad-task-list');
    const adTaskCountDisplay = document.getElementById('ad-task-count-display');
    const adReward = 20;

    function openWatchAdsPage() {
        const user = auth.currentUser; if(!user) { alert("Please log in to watch ads!"); return; }
        switchPage('watch-ads-page'); 
        initializeAdsPage();
    }

    async function initializeAdsPage() {
        const user = auth.currentUser; if (!user) return;
        const dailyAdLimit = appSettings.watchAdsLimit || 0;
        const today = new Date().toISOString().split('T')[0];
        const adRef = db.ref(`users/${user.uid}/dailyAdViews`);
        const snapshot = await adRef.once('value');
        let adData = snapshot.val();
        if (!adData || adData.lastViewDate !== today) {
            adData = { completedTasks: {}, lastViewDate: today };
            await adRef.set(adData);
        }
        const completedTasks = adData.completedTasks || {};
        const completedCount = Object.keys(completedTasks).length;
        const tasksRemaining = dailyAdLimit - completedCount;
        adTaskCountDisplay.textContent = `Today's Ads Remaining: ${tasksRemaining}/${dailyAdLimit}`;
        adTaskList.innerHTML = '';
        for (let i = 1; i <= dailyAdLimit; i++) {
            const adItem = document.createElement('div'); 
            adItem.className = 'ad-task-item';
            const adText = document.createElement('p'); 
            adText.textContent = `Ad Task ${i}`;
            const watchButton = document.createElement('button'); 
            watchButton.className = 'btn-watch-ad';
            if (completedTasks[i]) {
                watchButton.disabled = true; 
                watchButton.textContent = 'Completed';
            } else {
                watchButton.textContent = 'Watch'; 
                watchButton.onclick = () => watchFreeAd(i);
            }
            adItem.appendChild(adText); 
            adItem.appendChild(watchButton); 
            adTaskList.appendChild(adItem);
        }
    }

    async function watchFreeAd(taskNumber) {
        const user = auth.currentUser; if (!user) return;
        let adCompleted = false;

        const taskItem = document.querySelector(`#ad-task-list > .ad-task-item:nth-child(${taskNumber})`);
        const button = taskItem ? taskItem.querySelector('.btn-watch-ad') : null;
        if (button) {
            button.disabled = true;
            button.innerText = 'Processing...';
        }

        const adIndex = (taskNumber - 1) % vipAdScripts.length;
        const adData = vipAdScripts[adIndex];

        const grantReward = async () => {
            if (adCompleted) return;
            adCompleted = true;
            
            const adViewRef = db.ref(`users/${user.uid}/dailyAdViews`);
            await adViewRef.transaction(currentData => {
                const today = new Date().toISOString().split('T')[0];
                if (!currentData || currentData.lastViewDate !== today) {
                    currentData = { completedTasks: {}, lastViewDate: today };
                }
                if (!currentData.completedTasks) { currentData.completedTasks = {}; }
                currentData.completedTasks[taskNumber] = true;
                return currentData;
            });
            updateCoinBalance(adReward);
            alert(`Task ${taskNumber} complete! You earned ${adReward} coins.`);
            initializeAdsPage(); // Re-initialize to update UI
        };

        if (adIndex === 6) { // Ad 7 is a URL
            window.open(adData, '_blank');
            alert('An ad has been opened in a new tab. Please view it and your reward will be processed.');
            await grantReward();
        } else {
            const adModal = document.getElementById('ad-modal');
            const adModalContent = document.getElementById('ad-modal-content');

            adModalContent.innerHTML = `
                <div id="ad-container-free" style="display: flex; justify-content: center; align-items: center; flex-direction: column;"></div>
                <p style="font-size:12px; color: #8b949e; margin-top: 15px;">Please wait for the ad to load. This window will close automatically.</p>
            `;

            const adContainer = document.getElementById('ad-container-free');
            adContainer.innerHTML = adData;

            Array.from(adContainer.querySelectorAll("script")).forEach(oldScript => {
                const newScript = document.createElement("script");
                Array.from(oldScript.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value));
                if (oldScript.src) {
                    newScript.src = oldScript.src;
                } else {
                    newScript.appendChild(document.createTextNode(oldScript.innerHTML));
                }
                document.head.appendChild(newScript).parentNode.removeChild(newScript);
                adContainer.appendChild(newScript);
            });

            adModal.classList.remove('hidden');

            const closeAndClaim = async () => {
                if (adModal.classList.contains('hidden')) return;
                adModal.classList.add('hidden');
                await grantReward();
            };

            setTimeout(closeAndClaim, 20000);
        }
    }
    
    // --- START: General Knowledge Quiz Logic ---
    const quizQuestionText = document.getElementById('quiz-question-text');
    const quizOptionsContainer = document.getElementById('quiz-options-container');
    const quizCountDisplay = document.getElementById('quiz-count-display');
    const quizReward = 15; let quizQuestionSet = []; let currentQuestionIndex = 0; let currentQuizAnswer = '';

    function decodeHtml(html) { const txt = document.createElement("textarea"); txt.innerHTML = html; return txt.value; }
    async function fetchQuizQuestions(dailyQuizLimit) {
        quizQuestionText.textContent = 'Fetching new questions...'; quizOptionsContainer.innerHTML = '';
        try {
            const response = await fetch(`https://opentdb.com/api.php?amount=${dailyQuizLimit}&type=multiple`);
            if (!response.ok) throw new Error('Network response was not ok');
            const data = await response.json();
            if (data.results && data.results.length > 0) {
                quizQuestionSet = data.results.map(q => { const options = [...q.incorrect_answers.map(decodeHtml), decodeHtml(q.correct_answer)]; return { q: decodeHtml(q.question), o: options.sort(() => Math.random() - 0.5), a: decodeHtml(q.correct_answer) }; });
                return true;
            } else { throw new Error('No questions received from API.'); }
        } catch (error) { console.error("Failed to fetch quiz questions:", error); quizQuestionText.textContent = 'Could not load questions. Please try again later.'; return false; }
    }
    async function openQuizGame() { const user = auth.currentUser; if (!user) { alert("Please log in to play!"); return; } switchPage('quiz-page'); await initializeQuizPage(); }
    async function initializeQuizPage() {
        const user = auth.currentUser; if (!user) return;
        const dailyQuizLimit = appSettings.quizLimit || 0;
        const today = new Date().toISOString().split('T')[0];
        const quizRef = db.ref(`users/${user.uid}/dailyQuiz`);
        const snapshot = await quizRef.once('value');
        let quizData = snapshot.val();
        if (!quizData || quizData.lastQuizDate !== today) { quizData = { count: 0, lastQuizDate: today }; await quizRef.set(quizData); }
        const completedCount = quizData.count || 0; const tasksRemaining = dailyQuizLimit - completedCount;
        quizCountDisplay.textContent = `Today's Questions Remaining: ${tasksRemaining}/${dailyQuizLimit}`;
        if (tasksRemaining <= 0) { quizOptionsContainer.innerHTML = ''; quizQuestionText.textContent = 'No more questions for today. Come back tomorrow!';
        } else { const questionsLoaded = await fetchQuizQuestions(tasksRemaining); if (questionsLoaded) { currentQuestionIndex = 0; loadNewQuizQuestion(); } }
    }
    function loadNewQuizQuestion() {
        if (currentQuestionIndex >= quizQuestionSet.length) { quizOptionsContainer.innerHTML = ''; quizQuestionText.textContent = 'Something went wrong, please try again.'; return; }
        const currentQuiz = quizQuestionSet[currentQuestionIndex]; currentQuizAnswer = currentQuiz.a;
        quizQuestionText.innerHTML = currentQuiz.q; quizOptionsContainer.innerHTML = '';
        currentQuiz.o.forEach(option => { const button = document.createElement('button'); button.className = 'quiz-option-btn'; button.innerHTML = option; button.onclick = () => checkQuizAnswer(option, button); quizOptionsContainer.appendChild(button); });
    }
    function checkQuizAnswer(selectedOption, buttonElement) {
        document.querySelectorAll('#quiz-options-container .quiz-option-btn').forEach(btn => { btn.disabled = true; if (btn.innerHTML === currentQuizAnswer) { btn.classList.add('correct'); } });
        if (selectedOption === currentQuizAnswer) {
            buttonElement.classList.add('correct');
            setTimeout(() => {
                const onComplete = () => {
                    recordQuizSolve();
                };
                showVipStyleAdAndReward(quizReward, `Correct! You've won ${quizReward} coins.`, onComplete);
            }, 500);
        } else {
            buttonElement.classList.add('wrong');
            setTimeout(() => {
                alert("Wrong Answer! Try the next question.");
                recordQuizSolve();
            }, 500);
        }
    }
    async function recordQuizSolve() {
        const user = auth.currentUser; if (!user) return;
        const dailyQuizLimit = appSettings.quizLimit || 0;
        const quizRef = db.ref(`users/${user.uid}/dailyQuiz`);
        const { snapshot } = await quizRef.transaction(currentData => { const today = new Date().toISOString().split('T')[0]; if (currentData && currentData.lastQuizDate === today) { currentData.count = (currentData.count || 0) + 1; } else { currentData = { count: 1, lastQuizDate: today }; } return currentData; });
        const completedCount = snapshot.val().count; const tasksRemaining = dailyQuizLimit - completedCount;
        quizCountDisplay.textContent = `Today's Questions Remaining: ${tasksRemaining}/${dailyQuizLimit}`;
        if (tasksRemaining > 0) { currentQuestionIndex++; loadNewQuizQuestion(); } else { quizOptionsContainer.innerHTML = ''; quizQuestionText.textContent = 'No more questions for today. Come back tomorrow!'; }
    }
    
    // --- START: Bangla Quiz Logic ---
    const banglaQuizQuestionText = document.getElementById('bangla-quiz-question-text');
    const banglaQuizOptionsContainer = document.getElementById('bangla-quiz-options-container');
    const banglaQuizCountDisplay = document.getElementById('bangla-quiz-count-display');
    const banglaQuizReward = 10;
    let currentBanglaQuestion = {}; let currentBanglaQuestionIndex = -1;
    const banglaQuizQuestions = [
        { q: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶ú‡¶æ‡¶§‡ßÄ‡¶Ø‡¶º ‡¶´‡¶≤‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶ï‡¶ø?", o: ["‡¶Ü‡¶Æ", "‡¶ï‡¶æ‡¶Å‡¶†‡¶æ‡¶≤", "‡¶≤‡¶ø‡¶ö‡ßÅ", "‡¶ú‡¶æ‡¶Æ"], a: "‡¶ï‡¶æ‡¶Å‡¶†‡¶æ‡¶≤" }, { q: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶ú‡¶æ‡¶§‡ßÄ‡¶Ø‡¶º ‡¶∏‡¶Ç‡¶ó‡ßÄ‡¶§‡ßá‡¶∞ ‡¶∞‡¶ö‡¶Ø‡¶º‡¶ø‡¶§‡¶æ ‡¶ï‡ßá?", o: ["‡¶ï‡¶æ‡¶ú‡ßÄ ‡¶®‡¶ú‡¶∞‡ßÅ‡¶≤ ‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ", "‡¶∞‡¶¨‡ßÄ‡¶®‡ßç‡¶¶‡ßç‡¶∞‡¶®‡¶æ‡¶• ‡¶†‡¶æ‡¶ï‡ßÅ‡¶∞", "‡¶ú‡¶∏‡ßÄ‡¶Æ‡¶â‡¶¶‡ßç‡¶¶‡ßÄ‡¶®", "‡¶∏‡ßÅ‡¶ï‡ßÅ‡¶Æ‡¶æ‡¶∞ ‡¶∞‡¶æ‡¶Ø‡¶º"], a: "‡¶∞‡¶¨‡ßÄ‡¶®‡ßç‡¶¶‡ßç‡¶∞‡¶®‡¶æ‡¶• ‡¶†‡¶æ‡¶ï‡ßÅ‡¶∞" }, { q: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö ‡¶™‡¶∞‡ßç‡¶¨‡¶§‡¶∂‡ßÉ‡¶ô‡ßç‡¶ó‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶ï‡¶ø?", o: ["‡¶ï‡ßá‡¶ì‡¶ï‡ßç‡¶∞‡¶æ‡¶°‡¶Ç", "‡¶§‡¶æ‡¶ú‡¶ø‡¶®‡¶°‡¶Ç", "‡¶∏‡¶æ‡¶ï‡¶æ ‡¶π‡¶æ‡¶´‡¶Ç", "‡¶Æ‡ßã‡¶¶‡¶ï ‡¶Æ‡ßÅ‡¶Ø‡¶º‡¶æ‡¶≤"], a: "‡¶∏‡¶æ‡¶ï‡¶æ ‡¶π‡¶æ‡¶´‡¶Ç" }, { q: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶ú‡¶æ‡¶§‡ßÄ‡¶Ø‡¶º ‡¶™‡¶∂‡ßÅ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶ï‡¶ø?", o: ["‡¶π‡¶æ‡¶§‡¶ø", "‡¶∏‡¶ø‡¶Ç‡¶π", "‡¶∞‡¶Ø‡¶º‡ßá‡¶≤ ‡¶¨‡ßá‡¶ô‡ßç‡¶ó‡¶≤ ‡¶ü‡¶æ‡¶á‡¶ó‡¶æ‡¶∞", "‡¶ò‡ßã‡¶°‡¶º‡¶æ"], a: "‡¶∞‡¶Ø‡¶º‡ßá‡¶≤ ‡¶¨‡ßá‡¶ô‡ßç‡¶ó‡¶≤ ‡¶ü‡¶æ‡¶á‡¶ó‡¶æ‡¶∞" }, { q: "‚Äò‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶≠‡¶æ‡¶á‡¶Ø‡¶º‡ßá‡¶∞ ‡¶∞‡¶ï‡ßç‡¶§‡ßá ‡¶∞‡¶æ‡¶ô‡¶æ‡¶®‡ßã ‡¶è‡¶ï‡ßÅ‡¶∂‡ßá ‡¶´‡ßá‡¶¨‡ßç‡¶∞‡ßÅ‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø‚Äô ‡¶ó‡¶æ‡¶®‡¶ü‡¶ø‡¶∞ ‡¶∏‡ßÅ‡¶∞‡¶ï‡¶æ‡¶∞ ‡¶ï‡ßá?", o: ["‡¶Ü‡¶≤‡¶§‡¶æ‡¶´ ‡¶Æ‡¶æ‡¶π‡¶Æ‡ßÅ‡¶¶", "‡¶Ü‡¶¨‡¶¶‡ßÅ‡¶≤ ‡¶≤‡¶§‡¶ø‡¶´", "‡¶∏‡¶Æ‡¶∞ ‡¶¶‡¶æ‡¶∏", "‡¶ñ‡¶æ‡¶® ‡¶Ü‡¶§‡¶æ‡¶â‡¶∞ ‡¶∞‡¶π‡¶Æ‡¶æ‡¶®"], a: "‡¶Ü‡¶≤‡¶§‡¶æ‡¶´ ‡¶Æ‡¶æ‡¶π‡¶Æ‡ßÅ‡¶¶" }, { q: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶¨‡¶ø‡¶ú‡¶Ø‡¶º ‡¶¶‡¶ø‡¶¨‡¶∏ ‡¶ï‡¶¨‡ßá ‡¶™‡¶æ‡¶≤‡¶ø‡¶§ ‡¶π‡¶Ø‡¶º?", o: ["‡ß®‡ß¨‡¶∂‡ßá ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ö", "‡ßß‡ß™‡¶á ‡¶°‡¶ø‡¶∏‡ßá‡¶Æ‡ßç‡¶¨‡¶∞", "‡ßß‡ß¨‡¶á ‡¶°‡¶ø‡¶∏‡ßá‡¶Æ‡ßç‡¶¨‡¶∞", "‡ß®‡ßß‡¶∂‡ßá ‡¶´‡ßá‡¶¨‡ßç‡¶∞‡ßÅ‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø"], a: "‡ßß‡ß¨‡¶á ‡¶°‡¶ø‡¶∏‡ßá‡¶Æ‡ßç‡¶¨‡¶∞" }, { q: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶¶‡ßÄ‡¶∞‡ßç‡¶ò‡¶§‡¶Æ ‡¶®‡¶¶‡ßÄ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶ï‡¶ø?", o: ["‡¶™‡¶¶‡ßç‡¶Æ‡¶æ", "‡¶Æ‡ßá‡¶ò‡¶®‡¶æ", "‡¶Ø‡¶Æ‡ßÅ‡¶®‡¶æ", "‡¶¨‡ßç‡¶∞‡¶π‡ßç‡¶Æ‡¶™‡ßÅ‡¶§‡ßç‡¶∞"], a: "‡¶Æ‡ßá‡¶ò‡¶®‡¶æ" }, { q: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶ú‡¶æ‡¶§‡ßÄ‡¶Ø‡¶º ‡¶∏‡ßç‡¶Æ‡ßÉ‡¶§‡¶ø‡¶∏‡ßå‡¶ß‡ßá‡¶∞ ‡¶∏‡ßç‡¶•‡¶™‡¶§‡¶ø ‡¶ï‡ßá?", o: ["‡¶π‡¶æ‡¶Æ‡¶ø‡¶¶‡ßÅ‡¶∞ ‡¶∞‡¶π‡¶Æ‡¶æ‡¶®", "‡¶∏‡ßà‡¶Ø‡¶º‡¶¶ ‡¶Æ‡¶æ‡¶á‡¶®‡ßÅ‡¶≤ ‡¶π‡ßã‡¶∏‡ßá‡¶®", "‡¶§‡¶æ‡¶®‡¶≠‡ßÄ‡¶∞ ‡¶ï‡¶¨‡¶ø‡¶∞", "‡¶≤‡ßÅ‡¶á ‡¶ï‡¶æ‡¶®"], a: "‡¶∏‡ßà‡¶Ø‡¶º‡¶¶ ‡¶Æ‡¶æ‡¶á‡¶®‡ßÅ‡¶≤ ‡¶π‡ßã‡¶∏‡ßá‡¶®" }, { q: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶ú‡¶æ‡¶§‡ßÄ‡¶Ø‡¶º ‡¶Æ‡¶∏‡¶ú‡¶ø‡¶¶‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶ï‡¶ø?", o: ["‡¶¨‡¶æ‡¶Ø‡¶º‡¶§‡ßÅ‡¶≤ ‡¶Æ‡ßã‡¶ï‡¶æ‡¶∞‡¶∞‡¶Æ", "‡¶∑‡¶æ‡¶ü ‡¶ó‡¶Æ‡ßç‡¶¨‡ßÅ‡¶ú ‡¶Æ‡¶∏‡¶ú‡¶ø‡¶¶", "‡¶§‡¶æ‡¶∞‡¶æ ‡¶Æ‡¶∏‡¶ú‡¶ø‡¶¶", "‡¶ï‡¶¶‡¶Æ ‡¶∞‡¶∏‡ßÅ‡¶≤ ‡¶Æ‡¶∏‡¶ú‡¶ø‡¶¶"], a: "‡¶¨‡¶æ‡¶Ø‡¶º‡¶§‡ßÅ‡¶≤ ‡¶Æ‡ßã‡¶ï‡¶æ‡¶∞‡¶∞‡¶Æ" }, { q: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶Ü‡¶á‡¶®‡¶∏‡¶≠‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶ï‡¶ø?", o: ["‡¶≤‡ßã‡¶ï‡¶∏‡¶≠‡¶æ", "‡¶ú‡¶æ‡¶§‡ßÄ‡¶Ø‡¶º ‡¶∏‡¶Ç‡¶∏‡¶¶", "‡¶ó‡¶£‡¶™‡¶∞‡¶ø‡¶∑‡¶¶", "‡¶¨‡¶ø‡¶ß‡¶æ‡¶®‡¶∏‡¶≠‡¶æ"], a: "‡¶ú‡¶æ‡¶§‡ßÄ‡¶Ø‡¶º ‡¶∏‡¶Ç‡¶∏‡¶¶" }, { q: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶ú‡¶æ‡¶§‡ßÄ‡¶Ø‡¶º ‡¶ï‡¶¨‡¶ø‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶ï‡¶ø?", o: ["‡¶∞‡¶¨‡ßÄ‡¶®‡ßç‡¶¶‡ßç‡¶∞‡¶®‡¶æ‡¶• ‡¶†‡¶æ‡¶ï‡ßÅ‡¶∞", "‡¶ï‡¶æ‡¶ú‡ßÄ ‡¶®‡¶ú‡¶∞‡ßÅ‡¶≤ ‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ", "‡¶ú‡¶∏‡ßÄ‡¶Æ‡¶â‡¶¶‡ßç‡¶¶‡ßÄ‡¶®", "‡¶∂‡¶æ‡¶Æ‡¶∏‡ßÅ‡¶∞ ‡¶∞‡¶æ‡¶π‡¶Æ‡¶æ‡¶®"], a: "‡¶ï‡¶æ‡¶ú‡ßÄ ‡¶®‡¶ú‡¶∞‡ßÅ‡¶≤ ‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ" }, { q: "‡¶ï‡ßã‡¶®‡¶ü‡¶ø ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶¨‡ßÉ‡¶π‡¶§‡ßç‡¶§‡¶Æ ‡¶¶‡ßç‡¶¨‡ßÄ‡¶™?", o: ["‡¶∏‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ü‡¶ø‡¶®", "‡¶Æ‡¶π‡ßá‡¶∂‡¶ñ‡¶æ‡¶≤‡ßÄ", "‡¶≠‡ßã‡¶≤‡¶æ", "‡¶π‡¶æ‡¶§‡¶ø‡¶Ø‡¶º‡¶æ"], a: "‡¶≠‡ßã‡¶≤‡¶æ" }, { q: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶è‡¶ï‡¶æ‡¶°‡ßá‡¶Æ‡ßÄ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∑‡ßç‡¶†‡¶ø‡¶§ ‡¶π‡¶Ø‡¶º ‡¶ï‡¶§ ‡¶∏‡¶æ‡¶≤‡ßá?", o: ["‡ßß‡ßØ‡ß´‡ß®", "‡ßß‡ßØ‡ß´‡ß´", "‡ßß‡ßØ‡ß≠‡ßß", "‡ßß‡ßØ‡ß≠‡ß®"], a: "‡ßß‡ßØ‡ß´‡ß´" }, { q: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶ú‡¶æ‡¶§‡ßÄ‡¶Ø‡¶º ‡¶™‡¶§‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶®‡¶æ‡¶∞ ‡¶ï‡ßá?", o: ["‡¶ï‡¶æ‡¶Æ‡¶∞‡ßÅ‡¶≤ ‡¶π‡¶æ‡¶∏‡¶æ‡¶®", "‡¶ú‡¶Ø‡¶º‡¶®‡ßÅ‡¶≤ ‡¶Ü‡¶¨‡ßá‡¶¶‡¶ø‡¶®", "‡¶®‡¶ø‡¶§‡ßÅ‡¶® ‡¶ï‡ßÅ‡¶®‡ßç‡¶°‡ßÅ", "‡¶π‡¶æ‡¶Æ‡¶ø‡¶¶‡ßÅ‡¶∞ ‡¶∞‡¶π‡¶Æ‡¶æ‡¶®"], a: "‡¶ï‡¶æ‡¶Æ‡¶∞‡ßÅ‡¶≤ ‡¶π‡¶æ‡¶∏‡¶æ‡¶®" }, { q: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶ï‡¶Ø‡¶º‡¶ü‡¶ø ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶∏‡ßÄ‡¶Æ‡¶æ‡¶®‡ßç‡¶§ ‡¶∞‡¶Ø‡¶º‡ßá‡¶õ‡ßá?", o: ["‡ßß‡¶ü‡¶ø", "‡ß®‡¶ü‡¶ø", "‡ß©‡¶ü‡¶ø", "‡ß™‡¶ü‡¶ø"], a: "‡ß®‡¶ü‡¶ø" }, { q: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶è‡¶ï‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶™‡ßç‡¶∞‡¶¨‡¶æ‡¶≤ ‡¶¶‡ßç‡¶¨‡ßÄ‡¶™ ‡¶ï‡ßã‡¶®‡¶ü‡¶ø?", o: ["‡¶Æ‡¶π‡ßá‡¶∂‡¶ñ‡¶æ‡¶≤‡ßÄ", "‡¶®‡¶ø‡¶ù‡ßÅ‡¶Æ ‡¶¶‡ßç‡¶¨‡ßÄ‡¶™", "‡¶ï‡ßÅ‡¶§‡ßÅ‡¶¨‡¶¶‡¶ø‡¶Ø‡¶º‡¶æ", "‡¶∏‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ü‡¶ø‡¶®"], a: "‡¶∏‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ü‡¶ø‡¶®" }, { q: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶∞‡¶æ‡¶∑‡ßç‡¶ü‡ßç‡¶∞‡ßÄ‡¶Ø‡¶º ‡¶≠‡¶æ‡¶∑‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶ï‡¶ø?", o: ["‡¶á‡¶Ç‡¶∞‡ßá‡¶ú‡¶ø", "‡¶π‡¶ø‡¶®‡ßç‡¶¶‡¶ø", "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ", "‡¶â‡¶∞‡ßç‡¶¶‡ßÅ"], a: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ" }, { q: "‡¶∑‡¶æ‡¶ü ‡¶ó‡¶Æ‡ßç‡¶¨‡ßÅ‡¶ú ‡¶Æ‡¶∏‡¶ú‡¶ø‡¶¶ ‡¶ï‡ßã‡¶•‡¶æ‡¶Ø‡¶º ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶ø‡¶§?", o: ["‡¶¢‡¶æ‡¶ï‡¶æ", "‡¶∞‡¶æ‡¶ú‡¶∂‡¶æ‡¶π‡ßÄ", "‡¶ñ‡ßÅ‡¶≤‡¶®‡¶æ", "‡¶¨‡¶æ‡¶ó‡ßá‡¶∞‡¶π‡¶æ‡¶ü"], a: "‡¶¨‡¶æ‡¶ó‡ßá‡¶∞‡¶π‡¶æ‡¶ü" }, { q: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶ú‡¶æ‡¶§‡ßÄ‡¶Ø‡¶º ‡¶ñ‡ßá‡¶≤‡¶æ ‡¶ï‡¶ø?", o: ["‡¶ï‡ßç‡¶∞‡¶ø‡¶ï‡ßá‡¶ü", "‡¶´‡ßÅ‡¶ü‡¶¨‡¶≤", "‡¶π‡¶æ‡¶°‡ßÅ‡¶°‡ßÅ (‡¶ï‡¶æ‡¶¨‡¶æ‡¶°‡¶ø)", "‡¶∏‡¶æ‡¶Å‡¶§‡¶æ‡¶∞"], a: "‡¶π‡¶æ‡¶°‡ßÅ‡¶°‡ßÅ (‡¶ï‡¶æ‡¶¨‡¶æ‡¶°‡¶ø)" }, { q: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶ï‡ßã‡¶® ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó‡ßá ‡¶∏‡¶¨‡¶ö‡ßá‡¶Ø‡¶º‡ßá ‡¶¨‡ßá‡¶∂‡¶ø ‡¶ö‡¶æ ‡¶¨‡¶æ‡¶ó‡¶æ‡¶® ‡¶∞‡¶Ø‡¶º‡ßá‡¶õ‡ßá?", o: ["‡¶ö‡¶ü‡ßç‡¶ü‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ", "‡¶∏‡¶ø‡¶≤‡ßá‡¶ü", "‡¶∞‡¶Ç‡¶™‡ßÅ‡¶∞", "‡¶¢‡¶æ‡¶ï‡¶æ"], a: "‡¶∏‡¶ø‡¶≤‡ßá‡¶ü" }, { q: "‡¶≤‡¶æ‡¶≤‡¶¨‡¶æ‡¶ó ‡¶ï‡ßá‡¶≤‡ßç‡¶≤‡¶æ ‡¶ï‡ßá ‡¶®‡¶ø‡¶∞‡ßç‡¶Æ‡¶æ‡¶£ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßá‡¶®?", o: ["‡¶∂‡¶æ‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶§‡¶æ ‡¶ñ‡¶æ‡¶®", "‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ ‡¶ñ‡¶æ‡¶®", "‡¶Ø‡ßÅ‡¶¨‡¶∞‡¶æ‡¶ú ‡¶Æ‡ßã‡¶π‡¶æ‡¶Æ‡ßç‡¶Æ‡¶¶ ‡¶Ü‡¶Ø‡¶Æ", "‡¶Æ‡ßÄ‡¶∞ ‡¶ú‡ßÅ‡¶Æ‡¶≤‡¶æ"], a: "‡¶Ø‡ßÅ‡¶¨‡¶∞‡¶æ‡¶ú ‡¶Æ‡ßã‡¶π‡¶æ‡¶Æ‡ßç‡¶Æ‡¶¶ ‡¶Ü‡¶Ø‡¶Æ" }, { q: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶∞‡¶æ‡¶∑‡ßç‡¶ü‡ßç‡¶∞‡¶™‡¶§‡¶ø‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶ï‡¶ø?", o: ["‡¶§‡¶æ‡¶ú‡¶â‡¶¶‡ßç‡¶¶‡ßÄ‡¶® ‡¶Ü‡¶π‡¶Æ‡¶¶", "‡¶∏‡ßà‡¶Ø‡¶º‡¶¶ ‡¶®‡¶ú‡¶∞‡ßÅ‡¶≤ ‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ", "‡¶∂‡ßá‡¶ñ ‡¶Æ‡ßÅ‡¶ú‡¶ø‡¶¨‡ßÅ‡¶∞ ‡¶∞‡¶π‡¶Æ‡¶æ‡¶®", "‡¶ï‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶ü‡ßá‡¶® ‡¶Æ‡¶®‡¶∏‡ßÅ‡¶∞ ‡¶Ü‡¶≤‡ßÄ"], a: "‡¶∂‡ßá‡¶ñ ‡¶Æ‡ßÅ‡¶ú‡¶ø‡¶¨‡ßÅ‡¶∞ ‡¶∞‡¶π‡¶Æ‡¶æ‡¶®" }, { q: "‡¶Æ‡ßÅ‡¶ï‡ßç‡¶§‡¶ø‡¶Ø‡ßÅ‡¶¶‡ßç‡¶ß‡ßá‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂ ‡¶ï‡¶Ø‡¶º‡¶ü‡¶ø ‡¶∏‡ßá‡¶ï‡ßç‡¶ü‡¶∞‡ßá ‡¶¨‡¶ø‡¶≠‡¶ï‡ßç‡¶§ ‡¶õ‡¶ø‡¶≤?", o: ["‡ß≠‡¶ü‡¶ø", "‡ßØ‡¶ü‡¶ø", "‡ßß‡ßß‡¶ü‡¶ø", "‡ßß‡ß™‡¶ü‡¶ø"], a: "‡ßß‡ßß‡¶ü‡¶ø" }, { q: "‚Äò‡¶Ö‡¶∏‡¶Æ‡¶æ‡¶™‡ßç‡¶§ ‡¶Ü‡¶§‡ßç‡¶Æ‡¶ú‡ßÄ‡¶¨‡¶®‡ßÄ‚Äô ‡¶ó‡ßç‡¶∞‡¶®‡ßç‡¶•‡¶ü‡¶ø‡¶∞ ‡¶≤‡ßá‡¶ñ‡¶ï ‡¶ï‡ßá?", o: ["‡¶Æ‡¶ì‡¶≤‡¶æ‡¶®‡¶æ ‡¶≠‡¶æ‡¶∏‡¶æ‡¶®‡ßÄ", "‡¶è. ‡¶ï‡ßá. ‡¶´‡¶ú‡¶≤‡ßÅ‡¶≤ ‡¶π‡¶ï", "‡¶π‡ßã‡¶∏‡ßá‡¶® ‡¶∂‡¶π‡ßÄ‡¶¶ ‡¶∏‡ßã‡¶π‡ßç‚Äå‡¶∞‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶¶‡ßÄ", "‡¶¨‡¶ô‡ßç‡¶ó‡¶¨‡¶®‡ßç‡¶ß‡ßÅ ‡¶∂‡ßá‡¶ñ ‡¶Æ‡ßÅ‡¶ú‡¶ø‡¶¨‡ßÅ‡¶∞ ‡¶∞‡¶π‡¶Æ‡¶æ‡¶®"], a: "‡¶¨‡¶ô‡ßç‡¶ó‡¶¨‡¶®‡ßç‡¶ß‡ßÅ ‡¶∂‡ßá‡¶ñ ‡¶Æ‡ßÅ‡¶ú‡¶ø‡¶¨‡ßÅ‡¶∞ ‡¶∞‡¶π‡¶Æ‡¶æ‡¶®" }, { q: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶ï‡ßã‡¶® ‡¶∏‡ßç‡¶•‡¶æ‡¶®‡¶ï‡ßá ‚Äò‡¶∏‡¶æ‡¶ó‡¶∞ ‡¶ï‡¶®‡ßç‡¶Ø‡¶æ‚Äô ‡¶¨‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º?", o: ["‡¶ï‡¶ï‡ßç‡¶∏‡¶¨‡¶æ‡¶ú‡¶æ‡¶∞", "‡¶ï‡ßÅ‡¶Ø‡¶º‡¶æ‡¶ï‡¶æ‡¶ü‡¶æ", "‡¶™‡¶§‡ßá‡¶ô‡ßç‡¶ó‡¶æ", "‡¶á‡¶®‡¶æ‡¶®‡ßÄ"], a: "‡¶ï‡ßÅ‡¶Ø‡¶º‡¶æ‡¶ï‡¶æ‡¶ü‡¶æ" }, { q: "‚Äò‡¶∏‡¶æ‡¶§ ‡¶≠‡¶æ‡¶á ‡¶ö‡¶Æ‡ßç‡¶™‡¶æ‚Äô ‡¶≠‡¶æ‡¶∏‡ßç‡¶ï‡¶∞‡ßç‡¶Ø‡¶ü‡¶ø ‡¶ï‡ßã‡¶•‡¶æ‡¶Ø‡¶º ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶ø‡¶§?", o: ["‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂ ‡¶ö‡¶≤‡¶ö‡ßç‡¶ö‡¶ø‡¶§‡ßç‡¶∞ ‡¶â‡¶®‡ßç‡¶®‡¶Ø‡¶º‡¶® ‡¶ï‡¶∞‡ßç‡¶™‡ßã‡¶∞‡ßá‡¶∂‡¶® (FDC)", "‡¶∂‡¶ø‡¶∂‡ßÅ ‡¶è‡¶ï‡¶æ‡¶°‡ßá‡¶Æ‡ßÄ", "‡¶∂‡¶ø‡¶≤‡ßç‡¶™‡¶ï‡¶≤‡¶æ ‡¶è‡¶ï‡¶æ‡¶°‡ßá‡¶Æ‡ßÄ", "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶è‡¶ï‡¶æ‡¶°‡ßá‡¶Æ‡ßÄ"], a: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂ ‡¶ö‡¶≤‡¶ö‡ßç‡¶ö‡¶ø‡¶§‡ßç‡¶∞ ‡¶â‡¶®‡ßç‡¶®‡¶Ø‡¶º‡¶® ‡¶ï‡¶∞‡ßç‡¶™‡ßã‡¶∞‡ßá‡¶∂‡¶® (FDC)" }, { q: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶¨‡ßÉ‡¶π‡¶§‡ßç‡¶§‡¶Æ ‡¶¨‡¶ø‡¶≤ ‡¶ï‡ßã‡¶®‡¶ü‡¶ø?", o: ["‡¶ö‡¶≤‡¶® ‡¶¨‡¶ø‡¶≤", "‡¶§‡¶æ‡¶Æ‡¶æ ‡¶¨‡¶ø‡¶≤", "‡¶π‡¶æ‡¶ï‡¶æ‡¶≤‡ßÅ‡¶ï‡¶ø ‡¶π‡¶æ‡¶ì‡¶∞", "‡¶ü‡¶æ‡¶ô‡ßç‡¶ó‡ßÅ‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶π‡¶æ‡¶ì‡¶∞"], a: "‡¶ö‡¶≤‡¶® ‡¶¨‡¶ø‡¶≤" }, { q: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶ï‡ßã‡¶® ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶®‡ßÄ ‡¶™‡¶æ‡¶ü‡ßá‡¶∞ ‡¶ú‡ßÄ‡¶¨‡¶®‡¶∞‡¶π‡¶∏‡ßç‡¶Ø ‡¶â‡¶®‡ßç‡¶Æ‡ßã‡¶ö‡¶® ‡¶ï‡¶∞‡ßá‡¶®?", o: ["‡¶°. ‡¶ï‡ßÅ‡¶¶‡¶∞‡¶æ‡¶§-‡¶è-‡¶ñ‡ßÅ‡¶¶‡¶æ", "‡¶°. ‡¶ú‡¶æ‡¶Æ‡¶æ‡¶≤ ‡¶®‡¶ú‡¶∞‡ßÅ‡¶≤ ‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ", "‡¶°. ‡¶Æ‡¶æ‡¶ï‡¶∏‡ßÅ‡¶¶‡ßÅ‡¶≤ ‡¶Ü‡¶≤‡¶Æ", "‡¶°. ‡¶Æ‡ßÅ‡¶π‡¶Æ‡ßç‡¶Æ‡¶¶ ‡¶ú‡¶æ‡¶´‡¶∞ ‡¶á‡¶ï‡¶¨‡¶æ‡¶≤"], a: "‡¶°. ‡¶Æ‡¶æ‡¶ï‡¶∏‡ßÅ‡¶¶‡ßÅ‡¶≤ ‡¶Ü‡¶≤‡¶Æ" }, { q: "‡¶¢‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶¨‡¶ø‡¶ñ‡ßç‡¶Ø‡¶æ‡¶§ ‚Äò‡¶§‡¶æ‡¶∞‡¶æ ‡¶Æ‡¶∏‡¶ú‡¶ø‡¶¶‚Äô ‡¶ï‡ßá ‡¶®‡¶ø‡¶∞‡ßç‡¶Æ‡¶æ‡¶£ ‡¶ï‡¶∞‡ßá‡¶®?", o: ["‡¶∂‡¶æ‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶§‡¶æ ‡¶ñ‡¶æ‡¶®", "‡¶Æ‡¶ø‡¶∞‡ßç‡¶ú‡¶æ ‡¶ó‡ßã‡¶≤‡¶æ‡¶Æ ‡¶™‡ßÄ‡¶∞", "‡¶®‡¶¨‡¶æ‡¶¨ ‡¶Ü‡¶π‡¶∏‡¶æ‡¶®‡¶â‡¶≤‡ßç‡¶≤‡¶æ‡¶π", "‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ ‡¶ñ‡¶æ‡¶®"], a: "‡¶Æ‡¶ø‡¶∞‡ßç‡¶ú‡¶æ ‡¶ó‡ßã‡¶≤‡¶æ‡¶Æ ‡¶™‡ßÄ‡¶∞" }, { q: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶ï‡ßã‡¶®‡¶ü‡¶ø‡¶ï‡ßá ‚Äò‡¶™‡¶æ‡¶π‡¶æ‡ßú‡ßÄ ‡¶ï‡¶®‡ßç‡¶Ø‡¶æ‚Äô ‡¶¨‡¶≤‡¶æ ‡¶π‡ßü?", o: ["‡¶∞‡¶æ‡¶ô‡ßç‡¶ó‡¶æ‡¶Æ‡¶æ‡¶ü‡¶ø", "‡¶ñ‡¶æ‡¶ó‡ßú‡¶æ‡¶õ‡ßú‡¶ø", "‡¶¨‡¶æ‡¶®‡ßç‡¶¶‡¶∞‡¶¨‡¶æ‡¶®", "‡¶∏‡¶ø‡¶≤‡ßá‡¶ü"], a: "‡¶¨‡¶æ‡¶®‡ßç‡¶¶‡¶∞‡¶¨‡¶æ‡¶®" }, { q: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶®‡¶æ‡¶∞‡ßÄ ‡¶∏‡ßç‡¶™‡¶ø‡¶ï‡¶æ‡¶∞‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶ï‡¶ø?", o: ["‡¶¨‡ßá‡¶ó‡¶Æ ‡¶Æ‡¶§‡¶ø‡¶Ø‡¶º‡¶æ ‡¶ö‡ßå‡¶ß‡ßÅ‡¶∞‡ßÄ", "‡¶∏‡ßà‡¶Ø‡¶º‡¶¶‡¶æ ‡¶∏‡¶æ‡¶ú‡ßá‡¶¶‡¶æ ‡¶ö‡ßå‡¶ß‡ßÅ‡¶∞‡ßÄ", "‡¶°. ‡¶∂‡¶ø‡¶∞‡ßÄ‡¶® ‡¶∂‡¶æ‡¶∞‡¶Æ‡¶ø‡¶® ‡¶ö‡ßå‡¶ß‡ßÅ‡¶∞‡ßÄ", "‡¶¨‡ßá‡¶ó‡¶Æ ‡¶∞‡¶ì‡¶∂‡¶® ‡¶è‡¶∞‡¶∂‡¶æ‡¶¶"], a: "‡¶°. ‡¶∂‡¶ø‡¶∞‡ßÄ‡¶® ‡¶∂‡¶æ‡¶∞‡¶Æ‡¶ø‡¶® ‡¶ö‡ßå‡¶ß‡ßÅ‡¶∞‡ßÄ" }, { q: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶ú‡¶æ‡¶§‡ßÄ‡¶Ø‡¶º ‡¶¨‡ßÉ‡¶ï‡ßç‡¶∑ ‡¶ï‡ßã‡¶®‡¶ü‡¶ø?", o: ["‡¶Ü‡¶Æ ‡¶ó‡¶æ‡¶õ", "‡¶ï‡¶æ‡¶Å‡¶†‡¶æ‡¶≤ ‡¶ó‡¶æ‡¶õ", "‡¶¨‡¶ü ‡¶ó‡¶æ‡¶õ", "‡¶§‡¶æ‡¶≤ ‡¶ó‡¶æ‡¶õ"], a: "‡¶Ü‡¶Æ ‡¶ó‡¶æ‡¶õ" }, { q: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶ú‡¶æ‡¶§‡ßÄ‡¶Ø‡¶º ‡¶∏‡¶Ç‡¶∏‡¶¶‡ßá‡¶∞ ‡¶Ü‡¶∏‡¶® ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ ‡¶ï‡¶§?", o: ["‡ß©‡ß¶‡ß¶", "‡ß©‡ß´‡ß¶", "‡ß™‡ß¶‡ß¶", "‡ß™‡ß´‡ß¶"], a: "‡ß©‡ß´‡ß¶" }, { q: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶™‡ßç‡¶∞‡¶ß‡¶æ‡¶®‡¶Æ‡¶®‡ßç‡¶§‡ßç‡¶∞‡ßÄ ‡¶ï‡ßá ‡¶õ‡¶ø‡¶≤‡ßá‡¶®?", o: ["‡¶∂‡ßá‡¶ñ ‡¶Æ‡ßÅ‡¶ú‡¶ø‡¶¨‡ßÅ‡¶∞ ‡¶∞‡¶π‡¶Æ‡¶æ‡¶®", "‡¶§‡¶æ‡¶ú‡¶â‡¶¶‡ßç‡¶¶‡ßÄ‡¶® ‡¶Ü‡¶π‡¶Æ‡¶¶", "‡¶∏‡ßà‡¶Ø‡¶º‡¶¶ ‡¶®‡¶ú‡¶∞‡ßÅ‡¶≤ ‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ", "‡¶ï‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶ü‡ßá‡¶® ‡¶è‡¶Æ. ‡¶Æ‡¶®‡¶∏‡ßÅ‡¶∞ ‡¶Ü‡¶≤‡ßÄ"], a: "‡¶§‡¶æ‡¶ú‡¶â‡¶¶‡ßç‡¶¶‡ßÄ‡¶® ‡¶Ü‡¶π‡¶Æ‡¶¶" }, { q: "‚Äò‡¶ß‡¶®‡¶ß‡¶æ‡¶®‡ßç‡¶Ø ‡¶™‡ßÅ‡¶∑‡ßç‡¶™‡¶≠‡¶∞‡¶æ‚Äô ‡¶ó‡¶æ‡¶®‡¶ü‡¶ø‡¶∞ ‡¶∞‡¶ö‡¶Ø‡¶º‡¶ø‡¶§‡¶æ ‡¶ï‡ßá?", o: ["‡¶∞‡¶¨‡ßÄ‡¶®‡ßç‡¶¶‡ßç‡¶∞‡¶®‡¶æ‡¶• ‡¶†‡¶æ‡¶ï‡ßÅ‡¶∞", "‡¶ï‡¶æ‡¶ú‡ßÄ ‡¶®‡¶ú‡¶∞‡ßÅ‡¶≤ ‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ", "‡¶¶‡ßç‡¶¨‡¶ø‡¶ú‡ßá‡¶®‡ßç‡¶¶‡ßç‡¶∞‡¶≤‡¶æ‡¶≤ ‡¶∞‡¶æ‡¶Ø‡¶º", "‡¶∞‡¶ú‡¶®‡ßÄ‡¶ï‡¶æ‡¶®‡ßç‡¶§ ‡¶∏‡ßá‡¶®"], a: "‡¶¶‡ßç‡¶¨‡¶ø‡¶ú‡ßá‡¶®‡ßç‡¶¶‡ßç‡¶∞‡¶≤‡¶æ‡¶≤ ‡¶∞‡¶æ‡¶Ø‡¶º" }, { q: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶â‡¶∑‡ßç‡¶£‡¶§‡¶Æ ‡¶∏‡ßç‡¶•‡¶æ‡¶® ‡¶ï‡ßã‡¶®‡¶ü‡¶ø?", o: ["‡¶∞‡¶æ‡¶ú‡¶∂‡¶æ‡¶π‡ßÄ", "‡¶¶‡¶ø‡¶®‡¶æ‡¶ú‡¶™‡ßÅ‡¶∞", "‡¶Ø‡¶∂‡ßã‡¶∞", "‡¶≤‡¶æ‡¶≤‡¶™‡ßÅ‡¶∞, ‡¶®‡¶æ‡¶ü‡ßã‡¶∞"], a: "‡¶≤‡¶æ‡¶≤‡¶™‡ßÅ‡¶∞, ‡¶®‡¶æ‡¶ü‡ßã‡¶∞" }, { q: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶∂‡ßÄ‡¶§‡¶≤‡¶§‡¶Æ ‡¶∏‡ßç‡¶•‡¶æ‡¶® ‡¶ï‡ßã‡¶®‡¶ü‡¶ø?", o: ["‡¶™‡¶û‡ßç‡¶ö‡¶ó‡¶°‡¶º", "‡¶∂‡ßç‡¶∞‡ßÄ‡¶Æ‡¶ô‡ßç‡¶ó‡¶≤, ‡¶Æ‡ßå‡¶≤‡¶≠‡ßÄ‡¶¨‡¶æ‡¶ú‡¶æ‡¶∞", "‡¶¶‡¶ø‡¶®‡¶æ‡¶ú‡¶™‡ßÅ‡¶∞", "‡¶∞‡¶æ‡¶ú‡¶∂‡¶æ‡¶π‡ßÄ"], a: "‡¶∂‡ßç‡¶∞‡ßÄ‡¶Æ‡¶ô‡ßç‡¶ó‡¶≤, ‡¶Æ‡ßå‡¶≤‡¶≠‡ßÄ‡¶¨‡¶æ‡¶ú‡¶æ‡¶∞" }, { q: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶ï‡ßã‡¶® ‡¶ú‡ßá‡¶≤‡¶æ‡¶ï‡ßá ‚Äò‡¶∂‡¶∏‡ßç‡¶Ø ‡¶≠‡¶æ‡¶®‡ßç‡¶°‡¶æ‡¶∞‚Äô ‡¶¨‡¶≤‡¶æ ‡¶π‡ßü?", o: ["‡¶¶‡¶ø‡¶®‡¶æ‡¶ú‡¶™‡ßÅ‡¶∞", "‡¶¨‡¶∞‡¶ø‡¶∂‡¶æ‡¶≤", "‡¶∞‡¶Ç‡¶™‡ßÅ‡¶∞", "‡¶¨‡¶ó‡ßÅ‡ßú‡¶æ"], a: "‡¶¨‡¶∞‡¶ø‡¶∂‡¶æ‡¶≤" }, { q: "‚Äò‡¶§‡¶ø‡¶§‡¶æ‡¶∏ ‡¶è‡¶ï‡¶ü‡¶ø ‡¶®‡¶¶‡ßÄ‡¶∞ ‡¶®‡¶æ‡¶Æ‚Äô ‡¶â‡¶™‡¶®‡ßç‡¶Ø‡¶æ‡¶∏‡ßá‡¶∞ ‡¶≤‡ßá‡¶ñ‡¶ï ‡¶ï‡ßá?", o: ["‡¶Æ‡¶æ‡¶®‡¶ø‡¶ï ‡¶¨‡¶®‡ßç‡¶¶‡ßç‡¶Ø‡ßã‡¶™‡¶æ‡¶ß‡ßç‡¶Ø‡¶æ‡¶Ø‡¶º", "‡¶§‡¶æ‡¶∞‡¶æ‡¶∂‡¶ô‡ßç‡¶ï‡¶∞ ‡¶¨‡¶®‡ßç‡¶¶‡ßç‡¶Ø‡ßã‡¶™‡¶æ‡¶ß‡ßç‡¶Ø‡¶æ‡¶Ø‡¶º", "‡¶Ö‡¶¶‡ßç‡¶¨‡ßà‡¶§ ‡¶Æ‡¶≤‡ßç‡¶≤‡¶¨‡¶∞‡ßç‡¶Æ‡¶£", "‡¶¨‡¶ø‡¶≠‡ßÇ‡¶§‡¶ø‡¶≠‡ßÇ‡¶∑‡¶£ ‡¶¨‡¶®‡ßç‡¶¶‡ßç‡¶Ø‡ßã‡¶™‡¶æ‡¶ß‡ßç‡¶Ø‡¶æ‡¶Ø‡¶º"], a: "‡¶Ö‡¶¶‡ßç‡¶¨‡ßà‡¶§ ‡¶Æ‡¶≤‡ßç‡¶≤‡¶¨‡¶∞‡ßç‡¶Æ‡¶£" }, { q: "‡¶≠‡¶æ‡¶∑‡¶æ ‡¶Ü‡¶®‡ßç‡¶¶‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶∂‡¶π‡ßÄ‡¶¶ ‡¶ï‡ßá?", o: ["‡¶∏‡¶æ‡¶≤‡¶æ‡¶Æ", "‡¶¨‡¶∞‡¶ï‡¶§", "‡¶∞‡¶´‡¶ø‡¶ï", "‡¶ú‡¶¨‡ßç‡¶¨‡¶æ‡¶∞"], a: "‡¶∞‡¶´‡¶ø‡¶ï" }, { q: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶¨‡ßÉ‡¶π‡¶§‡ßç‡¶§‡¶Æ ‡¶∏‡ßá‡¶ö ‡¶™‡ßç‡¶∞‡¶ï‡¶≤‡ßç‡¶™ ‡¶ï‡ßã‡¶®‡¶ü‡¶ø?", o: ["‡¶ï‡¶∞‡ßç‡¶£‡¶´‡ßÅ‡¶≤‡ßÄ ‡¶∏‡ßá‡¶ö ‡¶™‡ßç‡¶∞‡¶ï‡¶≤‡ßç‡¶™", "‡¶§‡¶ø‡¶∏‡ßç‡¶§‡¶æ ‡¶¨‡¶æ‡¶Å‡¶ß ‡¶™‡ßç‡¶∞‡¶ï‡¶≤‡ßç‡¶™", "‡¶ó‡¶ô‡ßç‡¶ó‡¶æ-‡¶ï‡¶™‡ßã‡¶§‡¶æ‡¶ï‡ßç‡¶∑ ‡¶™‡ßç‡¶∞‡¶ï‡¶≤‡ßç‡¶™", "‡¶Æ‡ßÅ‡¶π‡ßÅ‡¶∞‡ßÄ ‡¶∏‡ßá‡¶ö ‡¶™‡ßç‡¶∞‡¶ï‡¶≤‡ßç‡¶™"], a: "‡¶§‡¶ø‡¶∏‡ßç‡¶§‡¶æ ‡¶¨‡¶æ‡¶Å‡¶ß ‡¶™‡ßç‡¶∞‡¶ï‡¶≤‡ßç‡¶™" }, { q: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶ï‡ßã‡¶® ‡¶Ö‡¶û‡ßç‡¶ö‡¶≤‡ßá ‚Äò‡¶ó‡¶æ‡¶∞‡ßã‚Äô ‡¶ï‡ßç‡¶∑‡ßÅ‡¶¶‡ßç‡¶∞ ‡¶®‡ßÉ-‡¶ó‡ßã‡¶∑‡ßç‡¶†‡ßÄ‡¶∞ ‡¶¨‡¶æ‡¶∏?", o: ["‡¶∏‡¶ø‡¶≤‡ßá‡¶ü", "‡¶ö‡¶ü‡ßç‡¶ü‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ", "‡¶Æ‡¶Ø‡¶º‡¶Æ‡¶®‡¶∏‡¶ø‡¶Ç‡¶π", "‡¶∞‡¶æ‡¶ú‡¶∂‡¶æ‡¶π‡ßÄ"], a: "‡¶Æ‡¶Ø‡¶º‡¶Æ‡¶®‡¶∏‡¶ø‡¶Ç‡¶π" }, { q: "‚Äò‡¶∏‡ßÅ‡¶≤‡¶§‡¶æ‡¶®‡¶ø ‡¶Ü‡¶Æ‡¶≤‡ßá‚Äô ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶∞ ‡¶∞‡¶æ‡¶ú‡¶ß‡¶æ‡¶®‡ßÄ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶ï‡¶ø ‡¶õ‡¶ø‡¶≤?", o: ["‡¶∏‡ßã‡¶®‡¶æ‡¶∞‡¶ó‡¶æ‡¶Å‡¶ì", "‡¶ó‡ßå‡¶°‡¶º", "‡¶¢‡¶æ‡¶ï‡¶æ", "‡¶™‡¶æ‡¶®‡ßç‡¶°‡ßÅ‡¶Ø‡¶º‡¶æ"], a: "‡¶ó‡ßå‡¶°‡¶º" }, { q: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶ú‡¶æ‡¶§‡ßÄ‡¶Ø‡¶º ‡¶∂‡¶ø‡¶∂‡ßÅ‡¶™‡¶æ‡¶∞‡ßç‡¶ï ‡¶ï‡ßã‡¶®‡¶ü‡¶ø?", o: ["‡¶¢‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶∂‡¶æ‡¶π‡¶¨‡¶æ‡¶ó‡ßá‡¶∞ ‡¶∂‡¶ø‡¶∂‡ßÅ‡¶™‡¶æ‡¶∞‡ßç‡¶ï", "‡¶Ø‡¶Æ‡ßÅ‡¶®‡¶æ ‡¶´‡¶ø‡¶â‡¶ö‡¶æ‡¶∞ ‡¶™‡¶æ‡¶∞‡ßç‡¶ï", "‡¶´‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶ü‡¶æ‡¶∏‡¶ø ‡¶ï‡¶ø‡¶Ç‡¶°‡¶Æ", "‡¶®‡¶®‡ßç‡¶¶‡¶® ‡¶™‡¶æ‡¶∞‡ßç‡¶ï"], a: "‡¶¢‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶∂‡¶æ‡¶π‡¶¨‡¶æ‡¶ó‡ßá‡¶∞ ‡¶∂‡¶ø‡¶∂‡ßÅ‡¶™‡¶æ‡¶∞‡ßç‡¶ï" }, { q: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶∏‡¶¨‡¶ö‡ßá‡¶Ø‡¶º‡ßá ‡¶¨‡¶°‡¶º ‡¶ö‡¶ø‡¶°‡¶º‡¶ø‡¶Ø‡¶º‡¶æ‡¶ñ‡¶æ‡¶®‡¶æ ‡¶ï‡ßã‡¶•‡¶æ‡¶Ø‡¶º ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶ø‡¶§?", o: ["‡¶Æ‡¶ø‡¶∞‡¶™‡ßÅ‡¶∞, ‡¶¢‡¶æ‡¶ï‡¶æ", "‡¶ó‡¶æ‡¶ú‡ßÄ‡¶™‡ßÅ‡¶∞", "‡¶ï‡ßÅ‡¶Æ‡¶ø‡¶≤‡ßç‡¶≤‡¶æ", "‡¶∞‡¶Ç‡¶™‡ßÅ‡¶∞"], a: "‡¶Æ‡¶ø‡¶∞‡¶™‡ßÅ‡¶∞, ‡¶¢‡¶æ‡¶ï‡¶æ" }, { q: "‚Äò‡¶®‡¶ï‡¶∂‡ßÄ ‡¶ï‡¶æ‡¶Å‡¶•‡¶æ‡¶∞ ‡¶Æ‡¶æ‡¶†‚Äô ‡¶ï‡¶æ‡¶¨‡ßç‡¶Ø‡¶ü‡¶ø‡¶∞ ‡¶∞‡¶ö‡¶Ø‡¶º‡¶ø‡¶§‡¶æ ‡¶ï‡ßá?", o: ["‡¶ï‡¶æ‡¶ú‡ßÄ ‡¶®‡¶ú‡¶∞‡ßÅ‡¶≤ ‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ", "‡¶∞‡¶¨‡ßÄ‡¶®‡ßç‡¶¶‡ßç‡¶∞‡¶®‡¶æ‡¶• ‡¶†‡¶æ‡¶ï‡ßÅ‡¶∞", "‡¶ú‡¶∏‡ßÄ‡¶Æ‡¶â‡¶¶‡ßç‡¶¶‡ßÄ‡¶®", "‡¶ú‡ßÄ‡¶¨‡¶®‡¶æ‡¶®‡¶®‡ßç‡¶¶ ‡¶¶‡¶æ‡¶∂"], a: "‡¶ú‡¶∏‡ßÄ‡¶Æ‡¶â‡¶¶‡ßç‡¶¶‡ßÄ‡¶®" }, { q: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶ú‡¶æ‡¶§‡ßÄ‡¶Ø‡¶º ‡¶â‡¶¶‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶ï‡¶ø?", o: ["‡¶≠‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶ú‡¶æ‡¶§‡ßÄ‡¶Ø‡¶º ‡¶â‡¶¶‡ßç‡¶Ø‡¶æ‡¶®", "‡¶≤‡¶æ‡¶â‡¶Ø‡¶º‡¶æ‡¶õ‡¶°‡¶º‡¶æ ‡¶ú‡¶æ‡¶§‡ßÄ‡¶Ø‡¶º ‡¶â‡¶¶‡ßç‡¶Ø‡¶æ‡¶®", "‡¶Æ‡¶ß‡ßÅ‡¶™‡ßÅ‡¶∞ ‡¶ú‡¶æ‡¶§‡ßÄ‡¶Ø‡¶º ‡¶â‡¶¶‡ßç‡¶Ø‡¶æ‡¶®", "‡¶∏‡ßÅ‡¶®‡ßç‡¶¶‡¶∞‡¶¨‡¶®"], a: "‡¶≠‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶ú‡¶æ‡¶§‡ßÄ‡¶Ø‡¶º ‡¶â‡¶¶‡ßç‡¶Ø‡¶æ‡¶®" }, { q: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶∏‡¶Ç‡¶¨‡¶ø‡¶ß‡¶æ‡¶® ‡¶ï‡¶¨‡ßá ‡¶ó‡ßÉ‡¶π‡ßÄ‡¶§ ‡¶π‡¶Ø‡¶º?", o: ["‡ßß‡ß¨ ‡¶°‡¶ø‡¶∏‡ßá‡¶Æ‡ßç‡¶¨‡¶∞, ‡ßß‡ßØ‡ß≠‡ßß", "‡ß®‡ß¨ ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ö, ‡ßß‡ßØ‡ß≠‡ß®", "‡ß™ ‡¶®‡¶≠‡ßá‡¶Æ‡ßç‡¶¨‡¶∞, ‡ßß‡ßØ‡ß≠‡ß®", "‡ßß‡ß¨ ‡¶°‡¶ø‡¶∏‡ßá‡¶Æ‡ßç‡¶¨‡¶∞, ‡ßß‡ßØ‡ß≠‡ß®"], a: "‡ß™ ‡¶®‡¶≠‡ßá‡¶Æ‡ßç‡¶¨‡¶∞, ‡ßß‡ßØ‡ß≠‡ß®" }, { q: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶∏‡ßç‡¶Ø‡¶æ‡¶ü‡ßá‡¶≤‡¶æ‡¶á‡¶ü‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶ï‡¶ø?", o: ["‡¶¨‡¶ô‡ßç‡¶ó‡¶¨‡¶®‡ßç‡¶ß‡ßÅ-‡ßß", "‡¶∏‡ßÇ‡¶∞‡ßç‡¶Ø-‡ßß", "‡¶Ö‡¶™‡¶∞‡¶æ‡¶ú‡¶ø‡¶§‡¶æ-‡ßß", "‡¶ú‡¶Ø‡¶º‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ-‡ßß"], a: "‡¶¨‡¶ô‡ßç‡¶ó‡¶¨‡¶®‡ßç‡¶ß‡ßÅ-‡ßß" }
    ];

    function openBanglaQuiz() {
        const user = auth.currentUser; if (!user) { alert("Please log in to play!"); return; }
        switchPage('bangla-quiz-page');
        initializeBanglaQuizPage();
    }
    
    async function initializeBanglaQuizPage() {
        const user = auth.currentUser; if (!user) return;
        const dailyBanglaQuizLimit = appSettings.banglaQuizLimit || 0;
        const today = new Date().toISOString().split('T')[0];
        const quizRef = db.ref(`users/${user.uid}/dailyBanglaQuiz`);
        const snapshot = await quizRef.once('value');
        let quizData = snapshot.val();
        if (!quizData || quizData.lastQuizDate !== today) {
            quizData = { count: 0, lastQuizDate: today };
            await quizRef.set(quizData);
        }
        const completedCount = quizData.count || 0;
        const tasksRemaining = dailyBanglaQuizLimit - completedCount;
        banglaQuizCountDisplay.textContent = `Today's Quizzes Remaining: ${tasksRemaining}/${dailyBanglaQuizLimit}`;
        if (tasksRemaining <= 0) {
            banglaQuizOptionsContainer.innerHTML = '';
            banglaQuizQuestionText.textContent = 'You have completed all quizzes for today. Come back tomorrow!';
        } else {
            loadNewBanglaQuestion();
        }
    }

    function loadNewBanglaQuestion() {
        banglaQuizQuestionText.textContent = "Loading question..."; banglaQuizOptionsContainer.innerHTML = '';
        const banglaQuizState = currentUserData.banglaQuizState || {};
        const seenIndices = banglaQuizState.seenIndices || [];
        const availableIndices = banglaQuizQuestions.map((_, index) => index).filter(index => !seenIndices.includes(index));
        if (availableIndices.length === 0) {
            banglaQuizQuestionText.textContent = "Great! You have answered all available questions."; return;
        }
        const randomAvailableIndex = Math.floor(Math.random() * availableIndices.length);
        currentBanglaQuestionIndex = availableIndices[randomAvailableIndex];
        currentBanglaQuestion = banglaQuizQuestions[currentBanglaQuestionIndex];
        banglaQuizQuestionText.textContent = currentBanglaQuestion.q;
        const shuffledOptions = [...currentBanglaQuestion.o].sort(() => Math.random() - 0.5);
        shuffledOptions.forEach(option => {
            const button = document.createElement('button');
            button.className = 'quiz-option-btn'; button.textContent = option;
            button.onclick = () => checkBanglaAnswer(option, button);
            banglaQuizOptionsContainer.appendChild(button);
        });
    }

    function checkBanglaAnswer(selectedOption, buttonElement) {
        document.querySelectorAll('#bangla-quiz-options-container .quiz-option-btn').forEach(btn => {
            btn.disabled = true;
            if (btn.textContent === currentBanglaQuestion.a) { btn.classList.add('correct'); }
        });
        const isCorrect = selectedOption === currentBanglaQuestion.a;
        buttonElement.classList.add(isCorrect ? 'correct' : 'wrong');
        setTimeout(() => {
            if (isCorrect) {
                const onComplete = () => {
                    recordBanglaQuizSolve(currentBanglaQuestionIndex);
                };
                showVipStyleAdAndReward(banglaQuizReward, `Correct! You won ${banglaQuizReward} coins.`, onComplete);
            } else {
                alert("Wrong answer! Try the next question.");
                recordBanglaQuizSolve(currentBanglaQuestionIndex);
            }
        }, 500);
    }
    
    async function recordBanglaQuizSolve(questionIndex) {
        const user = auth.currentUser; if (!user) return;
        const userRef = db.ref('users/' + user.uid);
        await userRef.transaction(currentData => {
            if (currentData) {
                const today = new Date().toISOString().split('T')[0];
                if (!currentData.dailyBanglaQuiz || currentData.dailyBanglaQuiz.lastQuizDate !== today) {
                    currentData.dailyBanglaQuiz = { count: 1, lastQuizDate: today };
                } else {
                    currentData.dailyBanglaQuiz.count++;
                }
                if (!currentData.banglaQuizState) { currentData.banglaQuizState = { seenIndices: [] }; }
                if (!currentData.banglaQuizState.seenIndices) { currentData.banglaQuizState.seenIndices = []; }
                if (!currentData.banglaQuizState.seenIndices.includes(questionIndex)) {
                     currentData.banglaQuizState.seenIndices.push(questionIndex);
                }
            }
            return currentData;
        });
        initializeBanglaQuizPage();
    }
    
    // --- START: Scratch Card Logic ---
    const scratchCanvas = document.getElementById('scratch-canvas');
    const scratchCtx = scratchCanvas.getContext('2d');
    const scratchPrizeDisplay = document.getElementById('scratch-prize-display');
    const scratchCountDisplay = document.getElementById('scratch-count-display');
    const scratchCursor = document.getElementById('scratch-cursor');
    let isScratching = false;
    let cardReady = false;

    function openScratchCard() {
        const user = auth.currentUser; if(!user) { alert("Please log in to play!"); return; }
        switchPage('scratch-card-page');
        initializeScratchPage();
    }

    async function initializeScratchPage() {
        const user = auth.currentUser; if (!user) return;
        const dailyScratchLimit = appSettings.scratchCardLimit || 0;
        const today = new Date().toISOString().split('T')[0];
        const scratchRef = db.ref(`users/${user.uid}/dailyScratches`);
        const snapshot = await scratchRef.once('value');
        let scratchData = snapshot.val();
        if (!scratchData || scratchData.lastScratchDate !== today) {
            scratchData = { count: 0, lastScratchDate: today };
            await scratchRef.set(scratchData);
        }
        const completedCount = scratchData.count || 0;
        const tasksRemaining = dailyScratchLimit - completedCount;
        scratchCountDisplay.textContent = `Today's Cards Remaining: ${tasksRemaining}/${dailyScratchLimit}`;

        if (tasksRemaining <= 0) {
            scratchPrizeDisplay.textContent = 'No more cards today!';
            scratchCtx.clearRect(0, 0, scratchCanvas.width, scratchCanvas.height); 
            cardReady = false;
        } else {
            setupNewScratchCard();
        }
    }

    function setupNewScratchCard() {
        const reward = Math.floor(Math.random() * 41) + 10;
        scratchPrizeDisplay.textContent = `You won ${reward} coins!`;
        scratchCtx.globalCompositeOperation = 'source-over';
        
        const grd = scratchCtx.createLinearGradient(0, 0, scratchCanvas.width, 0);
        grd.addColorStop(0, '#C0C0C0'); 
        grd.addColorStop(0.5, '#E8E8E8');
        grd.addColorStop(1, '#B4B4B4');
        scratchCtx.fillStyle = grd;
        scratchCtx.fillRect(0, 0, scratchCanvas.width, scratchCanvas.height);
        
        scratchCtx.fillStyle = 'rgba(0, 0, 0, 0.4)';
        scratchCtx.font = 'bold 24px Roboto';
        scratchCtx.textAlign = 'center';
        scratchCtx.textBaseline = 'middle';
        scratchCtx.fillText('SCRATCH HERE', scratchCanvas.width / 2, scratchCanvas.height / 2);
        
        cardReady = true;
    }

    function getScratchCoordinates(e) {
        const rect = scratchCanvas.getBoundingClientRect();
        const scaleX = scratchCanvas.width / rect.width;
        const scaleY = scratchCanvas.height / rect.height;
        const clientX = e.clientX || (e.touches && e.touches[0] ? e.touches[0].clientX : 0);
        const clientY = e.clientY || (e.touches && e.touches[0] ? e.touches[0].clientY : 0);
        return {
            x: (clientX - rect.left) * scaleX,
            y: (clientY - rect.top) * scaleY
        };
    }

    function scratch(e) {
        if (!isScratching || !cardReady) return;
        const coords = getScratchCoordinates(e);
        scratchCursor.style.left = `${e.clientX || (e.touches && e.touches[0] ? e.touches[0].clientX : 0)}px`;
        scratchCursor.style.top = `${e.clientY || (e.touches && e.touches[0] ? e.touches[0].clientY : 0)}px`;

        scratchCtx.globalCompositeOperation = 'destination-out';
        scratchCtx.beginPath();
        scratchCtx.arc(coords.x, coords.y, 35, 0, 2 * Math.PI);
        scratchCtx.fill();
    }
    
    function checkScratchComplete() {
        if (!cardReady) return;
        const imageData = scratchCtx.getImageData(0, 0, scratchCanvas.width, scratchCanvas.height);
        const pixelData = imageData.data;
        let transparentPixels = 0;
        for (let i = 0; i < pixelData.length; i += 4) {
            if (pixelData[i + 3] < 128) {
                transparentPixels++;
            }
        }
        const totalPixels = scratchCanvas.width * scratchCanvas.height;
        const percentageScratched = (transparentPixels / totalPixels) * 100;

        if (percentageScratched > 60) {
            cardReady = false; 
            const prizeText = scratchPrizeDisplay.textContent;
            const rewardMatch = prizeText.match(/\d+/);
            if (rewardMatch) {
                const reward = parseInt(rewardMatch[0]);
                const onComplete = () => {
                    recordScratch();
                };
                showVipStyleAdAndReward(reward, prizeText, onComplete);
            }
        }
    }
    
    async function recordScratch() {
        const user = auth.currentUser; if (!user) return;
        const scratchRef = db.ref(`users/${user.uid}/dailyScratches`);
        await scratchRef.transaction(currentData => {
            const today = new Date().toISOString().split('T')[0];
            if (currentData && currentData.lastScratchDate === today) {
                currentData.count++;
            } else {
                currentData = { count: 1, lastScratchDate: today };
            }
            return currentData;
        });
        setTimeout(initializeScratchPage, 500);
    }

    ['mousedown', 'touchstart'].forEach(evt => scratchCanvas.addEventListener(evt, (e) => { e.preventDefault(); isScratching = true; scratchCursor.style.display = 'block';}, { passive: false }));
    ['mouseup', 'mouseleave', 'touchend'].forEach(evt => scratchCanvas.addEventListener(evt, (e) => { e.preventDefault(); if(isScratching) { isScratching = false; checkScratchComplete(); } scratchCursor.style.display = 'none'; }, { passive: false }));
    ['mousemove', 'touchmove'].forEach(evt => scratchCanvas.addEventListener(evt, (e) => { e.preventDefault(); scratch(e); }, { passive: false }));

    document.addEventListener('DOMContentLoaded', () => {
        const userPanelWrapper = document.getElementById('user-panel-wrapper');
        const originalUserPanel = document.getElementById('user-panel');
        if (originalUserPanel.parentNode !== userPanelWrapper) {
            userPanelWrapper.appendChild(originalUserPanel);
        }
    });
</script>

</body>
</html>